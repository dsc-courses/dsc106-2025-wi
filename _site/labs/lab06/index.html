<!DOCTYPE html><html lang="en-US"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=Edge"><link rel="shortcut icon" href="/favicon.ico" type="image/x-icon"><link rel="stylesheet" href="/assets/css/just-the-docs-default.css"> <script src="/assets/js/vendor/lunr.min.js"></script> <script src="/assets/js/just-the-docs.js"></script><meta name="viewport" content="width=device-width, initial-scale=1"><title>Lab 6: Visualizing categorical data with D3 | DSC 106</title><meta name="generator" content="Jekyll v3.9.0" /><meta property="og:title" content="Lab 6: Visualizing categorical data with D3" /><meta name="author" content="Sam Lau" /><meta property="og:locale" content="en_US" /><meta name="description" content="DSC 106, Winter 2025 at UC San Diego" /><meta property="og:description" content="DSC 106, Winter 2025 at UC San Diego" /><link rel="canonical" href="http://localhost:4000/labs/lab06/" /><meta property="og:url" content="http://localhost:4000/labs/lab06/" /><meta property="og:site_name" content="DSC 106" /><meta property="og:type" content="website" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Lab 6: Visualizing categorical data with D3" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"WebPage","author":{"@type":"Person","name":"Sam Lau"},"description":"DSC 106, Winter 2025 at UC San Diego","headline":"Lab 6: Visualizing categorical data with D3","url":"http://localhost:4000/labs/lab06/"}</script> <script type="module" src="/assets/global.js"></script><link href="../labs.css" rel="stylesheet" /> <script src="../labs.js" type="module"></script><body> <a class="skip-to-main" href="#main-content">Skip to main content</a> <svg xmlns="http://www.w3.org/2000/svg" style="display: none;"> <symbol id="svg-link" viewBox="0 0 24 24"><title>Link</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"><title>Search</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"><title>Menu</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"><title>Expand</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"><polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"><title>Document</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"><path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> <symbol id="svg-external-link" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-external-link"><title id="svg-external-link-title">(external link)</title><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line> </symbol> </svg><div class="side-bar"><div class="site-header"> <a href="/" class="site-title lh-tight"> DSC 106 </a> <a href="#" id="menu-button" class="site-button"> <svg viewBox="0 0 24 24" class="icon"><use xlink:href="#svg-menu"></use></svg> </a></div><nav aria-label="Main" id="site-nav" class="site-nav"><ul class="nav-list"><li class="nav-list-item"><a href="/" class="nav-list-link">🏠 Home</a><li class="nav-list-item"><a href="/syllabus/" class="nav-list-link">📖 Syllabus</a><li class="nav-list-item"><a href="/calendar/" class="nav-list-link">📆 Calendar</a><li class="nav-list-item"><a href="/tech_support/" class="nav-list-link">🙋‍♂️ Tech Support</a><li class="nav-list-item"><a href="/resources/" class="nav-list-link">📚 Resources</a><li class="nav-list-item"><a href="/staff/" class="nav-list-link">👩‍🏫 Staff</a><li class="nav-list-item active"><a href="#" class="nav-list-expander" aria-label="toggle links in 👩‍🔬 Programming Labs category"> <svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg> </a><a href="/labs/" class="nav-list-link">👩‍🔬 Programming Labs</a><ul class="nav-list "><li class="nav-list-item "><a href="/labs/debugging/" class="nav-list-link">Help Us Help You: Things to try before asking for help</a><li class="nav-list-item "><a href="/labs/lab00/" class="nav-list-link">Lab 0: Setup</a><li class="nav-list-item "><a href="/labs/lab01/" class="nav-list-link">Lab 1: Introduction to the Web platform</a><li class="nav-list-item "><a href="/labs/lab02/" class="nav-list-link">Lab 2: Styling with CSS</a><li class="nav-list-item "><a href="/labs/lab03/" class="nav-list-link">Lab 3: Introduction to JS</a><li class="nav-list-item "><a href="/labs/lab04/" class="nav-list-link">Lab 4: Svelte (Templating & Control Flow)</a><li class="nav-list-item "><a href="/labs/lab05/" class="nav-list-link">Lab 5: Svelte II (Loading Data & Reactivity)</a><li class="nav-list-item active"><a href="/labs/lab06/" class="nav-list-link active">Lab 6: Visualizing categorical data with D3</a><li class="nav-list-item "><a href="/labs/lab07/" class="nav-list-link">Lab 7: Visualizing quantitative data with D3</a><li class="nav-list-item "><a href="/labs/lab08/" class="nav-list-link">Lab 8: Geospatial Visualizations</a><li class="nav-list-item "><a href="/labs/lab09/" class="nav-list-link">Lab 9: Animation & Scrollytelling</a></ul><li class="nav-list-item"><a href="#" class="nav-list-expander" aria-label="toggle links in 📝 Projects category"> <svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg> </a><a href="/projects/" class="nav-list-link">📝 Projects</a><ul class="nav-list "><li class="nav-list-item "><a href="/projects/final_project/" class="nav-list-link">Final Project</a><li class="nav-list-item "><a href="/projects/project1/" class="nav-list-link">Project 1: Expository Visualization</a><li class="nav-list-item "><a href="/projects/project2/" class="nav-list-link">Project 2: Deceptive Visualization</a><li class="nav-list-item "><a href="/projects/project2peer/" class="nav-list-link">Project 2: Deceptive Visualization - Peer Grading</a><li class="nav-list-item "><a href="/projects/project3/" class="nav-list-link">Project 3: Interactive Visualization</a><li class="nav-list-item "><a href="/projects/project3peer/" class="nav-list-link">Project 3: Interactive Visualization - Peer Grading</a></ul></ul></nav><footer class="site-footer"> This site uses <a href="https://github.com/just-the-docs/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll.</footer></div><div class="main" id="top"><div id="main-header" class="main-header"><div class="search"><div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search DSC 106" aria-label="Search DSC 106" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label></div><div id="search-results" class="search-results"></div></div><nav aria-label="Auxiliary" class="aux-nav"><ul class="aux-nav-list"><li class="aux-nav-list-item"> <a href="" class="site-button" > 💻 GitHub </a><li class="aux-nav-list-item"> <a href="" class="site-button" > 🙋 Ed </a><li class="aux-nav-list-item"> <a href="" class="site-button" > 💯 Gradescope </a></ul></nav></div><div id="main-content-wrap" class="main-content-wrap"><nav aria-label="Breadcrumb" class="breadcrumb-nav"><ol class="breadcrumb-nav-list"><li class="breadcrumb-nav-list-item"><a href="/labs/">👩‍🔬 Programming Labs</a><li class="breadcrumb-nav-list-item"><span>Lab 6: Visualizing categorical data with D3</span></ol></nav><div id="main-content" class="main-content" role="main"><h1 id="lab-6-visualizing-categorical-data-with-d3"> <a href="#lab-6-visualizing-categorical-data-with-d3" class="anchor-heading" aria-labelledby="lab-6-visualizing-categorical-data-with-d3"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Lab 6: Visualizing categorical data with D3</h1><blockquote class="no_toc summary"><p>In this lab, we will learn:</p><ul><li>What is SVG and what does it look like?<li>What does D3 do?<li>How can we use D3 to draw a pie chart?<li>How can we create reactive visualizations of data that is changing?<li>How can we make interactive visualizations that change the data displayed on the page?<li>How can we make interactive visualizations accessible?</ul></blockquote><details open=""> <summary class="text-delta"> Table of contents </summary><ul id="markdown-toc"><li><a href="#lab-6-visualizing-categorical-data-with-d3" id="markdown-toc-lab-6-visualizing-categorical-data-with-d3">Lab 6: Visualizing categorical data with D3</a><ul><li><a href="#check-off" id="markdown-toc-check-off">Check-off</a><li><a href="#questions-doc" id="markdown-toc-questions-doc"><a href="https://docs.google.com/document/d/1pgWQbf7FpseuojV1J4i2gzmgKhmlStOawYKLNQPc7bI/edit?usp=sharing" target="_blank" rel="noopener noreferrer">Questions Doc</a></a><li><a href="#slides-or-lack-thereof" id="markdown-toc-slides-or-lack-thereof">Slides (or lack thereof)</a><li><a href="#step-0-update-project-data-and-add-years" id="markdown-toc-step-0-update-project-data-and-add-years">Step 0: Update project data and add years</a><ul><li><a href="#step-01-show-year-in-each-project" id="markdown-toc-step-01-show-year-in-each-project">Step 0.1: Show year in each project</a></ul><li><a href="#step-1-creating-a-pie-chart-with-d3" id="markdown-toc-step-1-creating-a-pie-chart-with-d3">Step 1: Creating a pie chart with D3</a><ul><li><a href="#step-11-create-a-pie-component-and-use-it-in-your-project-page" id="markdown-toc-step-11-create-a-pie-component-and-use-it-in-your-project-page">Step 1.1: Create a <code class="language-plaintext highlighter-rouge">&lt;Pie&gt;</code> component and use it in your project page</a><li><a href="#step-12-create-a-circle-with-svg" id="markdown-toc-step-12-create-a-circle-with-svg">Step 1.2: Create a circle with SVG</a><li><a href="#step-13-using-a-path-instead-of-a-circle" id="markdown-toc-step-13-using-a-path-instead-of-a-circle">Step 1.3: Using a <code class="language-plaintext highlighter-rouge">&lt;path&gt;</code> instead of a <code class="language-plaintext highlighter-rouge">&lt;circle&gt;</code></a><li><a href="#step-13-drawing-our-circle-path-with-d3" id="markdown-toc-step-13-drawing-our-circle-path-with-d3">Step 1.3: Drawing our circle path with D3</a><li><a href="#step-14-drawing-a-static-pie-chart-with-d3" id="markdown-toc-step-14-drawing-a-static-pie-chart-with-d3">Step 1.4: Drawing a static pie chart with D3</a><li><a href="#step-15-adding-more-data" id="markdown-toc-step-15-adding-more-data">Step 1.5: Adding more data</a></ul><li><a href="#step-2-adding-a-legend" id="markdown-toc-step-2-adding-a-legend">Step 2: Adding a legend</a><ul><li><a href="#step-21-adding-labels-to-our-data" id="markdown-toc-step-21-adding-labels-to-our-data">Step 2.1: Adding labels to our data</a><li><a href="#step-22-adding-a-legend" id="markdown-toc-step-22-adding-a-legend">Step 2.2: Adding a legend</a><ul><li><a href="#making-the-swatch-look-like-a-swatch" id="markdown-toc-making-the-swatch-look-like-a-swatch">Making the swatch look like a swatch</a><li><a href="#applying-layout-on-the-list-to-make-it-look-like-a-legend" id="markdown-toc-applying-layout-on-the-list-to-make-it-look-like-a-legend">Applying layout on the list to make it look like a legend</a></ul><li><a href="#step-23-laying-out-our-pie-chart-and-legend-side-by-side" id="markdown-toc-step-23-laying-out-our-pie-chart-and-legend-side-by-side">Step 2.3: Laying out our pie chart and legend side by side</a></ul><li><a href="#step-3-plotting-our-actual-data" id="markdown-toc-step-3-plotting-our-actual-data">Step 3: Plotting our actual data</a><ul><li><a href="#step-31-making-data-a-prop" id="markdown-toc-step-31-making-data-a-prop">Step 3.1: Making <code class="language-plaintext highlighter-rouge">data</code> a prop</a><li><a href="#step-32-passing-project-data-via-the-data-prop" id="markdown-toc-step-32-passing-project-data-via-the-data-prop">Step 3.2: Passing project data via the <code class="language-plaintext highlighter-rouge">data</code> prop</a></ul><li><a href="#step-4-adding-a-search-for-our-projects-and-only-visualizing-visible-projects" id="markdown-toc-step-4-adding-a-search-for-our-projects-and-only-visualizing-visible-projects">Step 4: Adding a search for our projects and only visualizing visible projects</a><ul><li><a href="#step-41-adding-a-search-field" id="markdown-toc-step-41-adding-a-search-field">Step 4.1: Adding a search field</a><li><a href="#step-42-basic-search-functionality" id="markdown-toc-step-42-basic-search-functionality">Step 4.2: Basic search functionality</a><li><a href="#step-43-improving-the-search" id="markdown-toc-step-43-improving-the-search">Step 4.3: Improving the search</a><ul><li><a href="#make-the-search-case-insensitive" id="markdown-toc-make-the-search-case-insensitive">Make the search case-insensitive</a><li><a href="#search-across-all-project-metadata-not-just-titles" id="markdown-toc-search-across-all-project-metadata-not-just-titles">Search across all project metadata, not just titles</a></ul><li><a href="#step-44-visualizing-only-visible-projects" id="markdown-toc-step-44-visualizing-only-visible-projects">Step 4.4: Visualizing only visible projects</a></ul><li><a href="#step-5-turning-the-pie-into-filtering-ui-for-our-projects" id="markdown-toc-step-5-turning-the-pie-into-filtering-ui-for-our-projects">Step 5: Turning the pie into filtering UI for our projects</a><ul><li><a href="#step-51-highlighting-hovered-wedge" id="markdown-toc-step-51-highlighting-hovered-wedge">Step 5.1: Highlighting hovered wedge</a><li><a href="#step-52-highlighting-selected-wedge" id="markdown-toc-step-52-highlighting-selected-wedge">Step 5.2: Highlighting selected wedge</a><li><a href="#step-53-filtering-the-projects-by-the-selected-year" id="markdown-toc-step-53-filtering-the-projects-by-the-selected-year">Step 5.3: Filtering the projects by the selected year</a><li><a href="#step-54-fixing-accessibility-issues-optional-but-strongly-recommended" id="markdown-toc-step-54-fixing-accessibility-issues-optional-but-strongly-recommended">Step 5.4: Fixing accessibility issues (Optional, but strongly recommended)</a><li><a href="#step-55-better-selected-wedge-styling-optional" id="markdown-toc-step-55-better-selected-wedge-styling-optional">Step 5.5: Better selected wedge styling (Optional)</a></ul></ul></ul></details><hr /><h2 id="check-off"> <a href="#check-off" class="anchor-heading" aria-labelledby="check-off"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Check-off</h2><p><strong>You need to come to TA Office Hours to get checked off for this lab</strong> (any of them, no appointment needed). Please fill in <a href="checkoff">the check-off form at <code class="language-plaintext highlighter-rouge">labs/6/checkoff</code></a> <em>before</em> your check-off. Ideally you should fill in the form <em>right before</em> your check-off, but it’s ok if you fill it out in advance.</p><p class="warning">Filling out the form is a necessary but not sufficient condition to get checked-off. <strong>You still need to come to office hours in person for your check-off to be processed.</strong></p><p>You could even fill it out before you finish the lab, since we won’t look at it until your check-off, but the closer to the end of the lab you fill it out, the more meaningful your feedback will be.</p><h2 id="questions-doc"> <a href="#questions-doc" class="anchor-heading" aria-labelledby="questions-doc"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <a href="https://docs.google.com/document/d/1pgWQbf7FpseuojV1J4i2gzmgKhmlStOawYKLNQPc7bI/edit?usp=sharing" target="_blank" rel="noopener noreferrer">Questions Doc</a></h2><p>Add questions to the questions doc throughout the lecture and lab! After lab, come to <a href="../../logistics/staff.html#office-hours">office hours</a> or ask on <a href="https://vis-society-forum.csail.mit.edu/">Discourse</a> for futher questions!</p><h2 id="slides-or-lack-thereof"> <a href="#slides-or-lack-thereof" class="anchor-heading" aria-labelledby="slides-or-lack-thereof"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Slides (or lack thereof)</h2><p>No slides for this lab! Since the topic was covered in Monday’s lecture, it can be helpful for you to review the <a href="../../lectures/intro-svelte-d3.html">material from it</a>.</p><p class="note">This lab is a little more involved than some of the previous labs, because it’s introducing the core technical material around data visualization. A robust understanding of these concepts will be invaluable as you work on your final projects, so spending time practicing them for the lab will be time will spent.</p><h2 id="step-0-update-project-data-and-add-years"> <a href="#step-0-update-project-data-and-add-years" class="anchor-heading" aria-labelledby="step-0-update-project-data-and-add-years"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Step 0: Update project data and add years</h2><p>If you have not yet done <a href="../../labs/5/#step-3-update-your-project-data">Step 3 of Lab 5</a>, you should do it now.</p><h3 id="step-01-show-year-in-each-project"> <a href="#step-01-show-year-in-each-project" class="anchor-heading" aria-labelledby="step-01-show-year-in-each-project"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Step 0.1: Show year in each project</h3><p>Since we have the year data, we should show it in the project list. That way we can also more easily verify whether our code in the rest of the lab works correctly.</p><p>Edit the <code class="language-plaintext highlighter-rouge">&lt;Project&gt;</code> component (in <code class="language-plaintext highlighter-rouge">src/lib/Project.svelte</code>) to show the year of the project. You can use any HTML you deem suitable and style it however you want. I placed it under the project description (you’ll need to wrap both in the ame <code class="language-plaintext highlighter-rouge">&lt;div&gt;</code> otherwise they will occupy the same grid cell and overlap), and styled it like this:</p><p><img src="/labs/lab06/images/project-year.png" alt="Three projects with the year shown in gray letters underneath the description" /></p><p class="tip">In case you like the above, the font-family is <code class="language-plaintext highlighter-rouge">Baskerville</code> (a system font) and I’m using <code class="language-plaintext highlighter-rouge">font-variant-numeric: oldstyle-nums</code> to make the numbers look a bit more like they belong in the text.</p><blockquote class="note"><p>From this point onwards, there are only two files that we will be editing in this lab:</p><ol><li><code class="language-plaintext highlighter-rouge">src/lib/Pie.svelte</code> (created in Step 1.1)<li><code class="language-plaintext highlighter-rouge">src/routes/projects/+page.svelte</code> (our projects page)</ol></blockquote><h2 id="step-1-creating-a-pie-chart-with-d3"> <a href="#step-1-creating-a-pie-chart-with-d3" class="anchor-heading" aria-labelledby="step-1-creating-a-pie-chart-with-d3"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Step 1: Creating a pie chart with D3</h2><h3 id="step-11-create-a-pie-component-and-use-it-in-your-project-page"> <a href="#step-11-create-a-pie-component-and-use-it-in-your-project-page" class="anchor-heading" aria-labelledby="step-11-create-a-pie-component-and-use-it-in-your-project-page"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Step 1.1: Create a <code class="language-plaintext highlighter-rouge">&lt;Pie&gt;</code> component and use it in your project page</h3><p>To keep the code manageable, we will be creating our pie chart in a separate component, called <code class="language-plaintext highlighter-rouge">&lt;Pie&gt;</code>.</p><p>Create a new <code class="language-plaintext highlighter-rouge">Pie.svelte</code> file in <code class="language-plaintext highlighter-rouge">src/lib</code> and add some text in it, e.g. “Hello from Pie.svelte”. Then, in your projects page, import the <code class="language-plaintext highlighter-rouge">&lt;Pie&gt;</code> component:</p><div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nx">Pie</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">$lib/Pie.svelte</span><span class="dl">'</span><span class="p">;</span>
</code></pre></div></div><p>and then use it like <code class="language-plaintext highlighter-rouge">&lt;Pie /&gt;</code>. Save, and make sure the text you wrote in <code class="language-plaintext highlighter-rouge">Pie.svelte</code> is displayed in your project page to make sure all plumbing is working.</p><h3 id="step-12-create-a-circle-with-svg"> <a href="#step-12-create-a-circle-with-svg" class="anchor-heading" aria-labelledby="step-12-create-a-circle-with-svg"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Step 1.2: Create a circle with SVG</h3><p>The first step to create a pie chart with D3 is to create an <code class="language-plaintext highlighter-rouge">&lt;svg&gt;</code> element in the <code class="language-plaintext highlighter-rouge">&lt;Pie&gt;</code> component.</p><p class="fyi">D3 is a library that translates high level visualization concepts into low level drawing commands. The technology currently used for these drawing commands is called <a href="https://developer.mozilla.org/en-US/docs/Web/SVG">SVG</a> and is a language for drawing <a href="https://en.wikipedia.org/wiki/Vector_graphics">vector graphics</a>. This means that instead of drawing pixels on a screen, SVG draws shapes and lines using descriptions of their geometry (e.g. centerpoints, radius, start and end coordinates, etc.). It looks very much like HTML, with elements delineated by tags, tags delineated by angle brackets, and attributes within those tags. However, instead of content-focused elements like <code class="language-plaintext highlighter-rouge">&lt;h1&gt;</code> and <code class="language-plaintext highlighter-rouge">&lt;p&gt;</code>, we have drawing-focused elements like <code class="language-plaintext highlighter-rouge">&lt;circle&gt;</code> and <code class="language-plaintext highlighter-rouge">&lt;path&gt;</code>. SVG code can live either in separate files (with an <code class="language-plaintext highlighter-rouge">.svg</code> extension) or be embedded in HTML via the <code class="language-plaintext highlighter-rouge">&lt;svg&gt;</code> elements.</p><p>We will give it a <a href="https://developer.mozilla.org/en-US/docs/Web/SVG/Attribute/viewBox"><code class="language-plaintext highlighter-rouge">viewBox</code></a> of <code class="language-plaintext highlighter-rouge">-50 -50 100 100</code> which defines the coordinate system it will use internally. In this case, it will have a width and height of 100, and the (0, 0) point will be in the center (which is quite convenient for a pie chart!).</p><p>We can use these coordinates to e.g. draw a red circle within it with a center at (0, 0) and a radius of 50 via the SVG <a href="https://developer.mozilla.org/en-US/docs/Web/SVG/Element/circle"><code class="language-plaintext highlighter-rouge">&lt;circle&gt;</code></a> element:</p><div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;svg</span> <span class="na">viewBox=</span><span class="s">"-50 -50 100 100"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;circle</span> <span class="na">cx=</span><span class="s">"0"</span> <span class="na">cy=</span><span class="s">"0"</span> <span class="na">r=</span><span class="s">"50"</span> <span class="na">fill=</span><span class="s">"red"</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/svg&gt;</span>
</code></pre></div></div><p>Since we have not given the graphic any explicit dimensions, by default it will occupy the entire width of its parent container and will have an aspect ratio of 1:1 (as defined by its coordinate system). It will look a bit like this:</p><p><img src="images/svg-circle.png" alt="" class="browser" data-url="http://localhost:5173/projects" /></p><p>We can add some CSS in the component’s <code class="language-plaintext highlighter-rouge">&lt;style&gt;</code> element to limit its size a bit and also add some spacing around it:</p><div class="language-css highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">svg</span> <span class="p">{</span>
  <span class="nl">max-width</span><span class="p">:</span> <span class="m">20em</span><span class="p">;</span>
  <span class="py">margin-block</span><span class="p">:</span> <span class="m">2em</span><span class="p">;</span>

  <span class="c">/* Do not clip shapes outside the viewBox */</span>
  <span class="nl">overflow</span><span class="p">:</span> <span class="nb">visible</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div><p>This will make it look like this:</p><p><img src="images/svg-circle-width.png" alt="" class="browser" data-url="http://localhost:5173/projects" /></p><h3 id="step-13-using-a-path-instead-of-a-circle"> <a href="#step-13-using-a-path-instead-of-a-circle" class="anchor-heading" aria-labelledby="step-13-using-a-path-instead-of-a-circle"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Step 1.3: Using a <code class="language-plaintext highlighter-rouge">&lt;path&gt;</code> instead of a <code class="language-plaintext highlighter-rouge">&lt;circle&gt;</code></h3><p>A <a href="https://developer.mozilla.org/en-US/docs/Web/SVG/Element/circle"><code class="language-plaintext highlighter-rouge">&lt;circle&gt;</code></a> element is an easy way to draw a circle, but we can’t really go anywhere from there: it can <em>only</em> draw circles. If we were drawing pie charts directly in SVG, we’d need to switch to another element, that is more complicated, but also more powerful: the <a href="https://developer.mozilla.org/en-US/docs/Web/SVG/Element/path"><code class="language-plaintext highlighter-rouge">&lt;path&gt;</code></a> element.</p><p>The <a href="https://developer.mozilla.org/en-US/docs/Web/SVG/Element/path"><code class="language-plaintext highlighter-rouge">&lt;path&gt;</code></a> element can draw any shape, but its syntax is a little unwieldy. It uses a string of commands to describe the shape, where each command is a single letter followed by a series of numbers that specify command parameters. All of this is stuffed into a single <a href="https://developer.mozilla.org/en-US/docs/Web/SVG/Attribute/d"><code class="language-plaintext highlighter-rouge">d</code></a> attribute.</p><p>Here is our circle as a <code class="language-plaintext highlighter-rouge">&lt;path&gt;</code> element:</p><div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;svg</span> <span class="na">viewBox=</span><span class="s">"-50 -50 100 100"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;path</span> <span class="na">d=</span><span class="s">"M -50 0 A 50 50 0 0 1 50 0 A 50 50 0 0 1 -50 0"</span> <span class="na">fill=</span><span class="s">"red"</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/svg&gt;</span>
</code></pre></div></div><p>This draws the circle as two arcs, each of which is defined by its start and end points, its radius, and a few flags that control its shape. Before you run away screaming, worry not, because D3 saves us from this chaos by <em>generating</em> the path strings for us. Let’s use it then!</p><h3 id="step-13-drawing-our-circle-path-with-d3"> <a href="#step-13-drawing-our-circle-path-with-d3" class="anchor-heading" aria-labelledby="step-13-drawing-our-circle-path-with-d3"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Step 1.3: Drawing our circle path with D3</h3><p>Now let’s use D3 to create the same path, as a first step towards our pie chart.</p><p>First, we need to add D3 to our project so we can use it in our JS code. Open the VS Code terminal and run:</p><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>npm <span class="nb">install </span>d3
</code></pre></div></div><p>Ignore any warnings about peer dependencies.</p><p>So now that D3 is installed how do we use it? In your Pie component, add the following import statement at the top of the <code class="language-plaintext highlighter-rouge">&lt;script&gt;</code> element:</p><div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="o">*</span> <span class="k">as</span> <span class="nx">d3</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">d3</span><span class="dl">'</span><span class="p">;</span>
</code></pre></div></div><p>Now let’s use the <a href="https://d3js.org/d3-shape/arc#arc"><code class="language-plaintext highlighter-rouge">d3.arc()</code></a> function from the <a href="https://d3js.org/d3-shape">D3 Shape</a> module to create the path for our circle. This works with two parts: first, we create an <em>arc generator</em> which is a function that takes data and returns a path string. We’ll configure it to produce arcs based on a radius of <code class="language-plaintext highlighter-rouge">50</code> by adding <code class="language-plaintext highlighter-rouge">.innerRadius(0).outerRadius(50)</code>. If you instead want to create a donut chart, it’s as easy as changing the inner radius to something other than <code class="language-plaintext highlighter-rouge">0</code>!</p><div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">let</span> <span class="nx">arcGenerator</span> <span class="o">=</span> <span class="nx">d3</span><span class="p">.</span><span class="nx">arc</span><span class="p">().</span><span class="nx">innerRadius</span><span class="p">(</span><span class="mi">0</span><span class="p">).</span><span class="nx">outerRadius</span><span class="p">(</span><span class="mi">50</span><span class="p">);</span>
</code></pre></div></div><p>We then generate an arc by providing a starting angle (<code class="language-plaintext highlighter-rouge">0</code>) and an ending angle in radians (<code class="language-plaintext highlighter-rouge">2 * Math.PI</code>) to create a full circle:</p><div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">let</span> <span class="nx">arc</span> <span class="o">=</span> <span class="nx">arcGenerator</span><span class="p">({</span>
  <span class="na">startAngle</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
  <span class="na">endAngle</span><span class="p">:</span> <span class="mi">2</span> <span class="o">*</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">PI</span><span class="p">,</span>
<span class="p">});</span>
</code></pre></div></div><blockquote class="fyi"><p>Did we need two statements? Not really, we only did so for readability. This would have been perfectly valid JS:</p><div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">let</span> <span class="nx">arc</span> <span class="o">=</span> <span class="nx">d3</span><span class="p">.</span><span class="nx">arc</span><span class="p">().</span><span class="nx">innerRadius</span><span class="p">(</span><span class="mi">0</span><span class="p">).</span><span class="nx">outerRadius</span><span class="p">(</span><span class="mi">50</span><span class="p">)({</span>
  <span class="na">startAngle</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
  <span class="na">endAngle</span><span class="p">:</span> <span class="mi">2</span> <span class="o">*</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">PI</span><span class="p">,</span>
<span class="p">});</span>
</code></pre></div></div></blockquote><p>Now that we have our path, we can add it to our SVG:</p><div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;svg</span> <span class="na">viewBox=</span><span class="s">"-50 -50 100 100"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;path</span> <span class="na">d=</span><span class="s">"{arc}"</span> <span class="na">fill=</span><span class="s">"red"</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/svg&gt;</span>
</code></pre></div></div><h3 id="step-14-drawing-a-static-pie-chart-with-d3"> <a href="#step-14-drawing-a-static-pie-chart-with-d3" class="anchor-heading" aria-labelledby="step-14-drawing-a-static-pie-chart-with-d3"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Step 1.4: Drawing a static pie chart with D3</h3><p>’Nuff dilly-dallying with circles, let’s cut to the chase and draw a pie chart! Let’s draw a pie chart with two slices, one for each of the numbers <code class="language-plaintext highlighter-rouge">1</code> and <code class="language-plaintext highlighter-rouge">2</code>, i.e. a 33% and 66% slice.</p><div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">let</span> <span class="nx">data</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">];</span>
</code></pre></div></div><p>We’ll draw our pie chart as two <code class="language-plaintext highlighter-rouge">&lt;path&gt;</code> elements, one for each slice. First, we need to calculate the total, so we can then figure out what proportion of the total each slice represents:</p><div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">let</span> <span class="nx">total</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

<span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">d</span> <span class="k">of</span> <span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">total</span> <span class="o">+=</span> <span class="nx">d</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div><p>Then, we calculate the start and end angles for each slice:</p><div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">let</span> <span class="nx">angle</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="kd">let</span> <span class="nx">arcData</span> <span class="o">=</span> <span class="p">[];</span>

<span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">d</span> <span class="k">of</span> <span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">let</span> <span class="nx">endAngle</span> <span class="o">=</span> <span class="nx">angle</span> <span class="o">+</span> <span class="p">(</span><span class="nx">d</span> <span class="o">/</span> <span class="nx">total</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">*</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">PI</span><span class="p">;</span>
  <span class="nx">arcData</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span> <span class="na">startAngle</span><span class="p">:</span> <span class="nx">angle</span><span class="p">,</span> <span class="nx">endAngle</span> <span class="p">});</span>
  <span class="nx">angle</span> <span class="o">=</span> <span class="nx">endAngle</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div><p>And now we can finally calculate the actual paths for each of these slices:</p><div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">let</span> <span class="nx">arcs</span> <span class="o">=</span> <span class="nx">arcData</span><span class="p">.</span><span class="nx">map</span><span class="p">((</span><span class="nx">d</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">arcGenerator</span><span class="p">(</span><span class="nx">d</span><span class="p">));</span>
</code></pre></div></div><p>Now let’s wrap our <code class="language-plaintext highlighter-rouge">&lt;path&gt;</code> element with an <code class="language-plaintext highlighter-rouge">{#each}</code> block since we are now generating multiple paths:</p><div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code>{#each arcs as arc}
<span class="nt">&lt;path</span> <span class="na">d=</span><span class="s">"{arc}"</span> <span class="na">fill=</span><span class="s">"red"</span> <span class="nt">/&gt;</span>
{/each}
</code></pre></div></div><p>If we reload at this point, all we see is …the same red circle. A bit anticlimactic, isn’t it?</p><p>However, if you inspect the circle, you will see it actually consists of two <code class="language-plaintext highlighter-rouge">&lt;path&gt;</code> elements. We just don’t see it, because they’re both the same color!</p><p><img src="images/two-paths.png" alt="" class="browser" data-url="http://localhost:5173/projects" /></p><p>Let’s assign different colors to our slices, by adding a <code class="language-plaintext highlighter-rouge">colors</code> array and using it to set the <code class="language-plaintext highlighter-rouge">fill</code> attribute of our paths:</p><div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">let</span> <span class="nx">colors</span> <span class="o">=</span> <span class="p">[</span><span class="dl">'</span><span class="s1">gold</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">purple</span><span class="dl">'</span><span class="p">];</span>
</code></pre></div></div><p>Then we convert our code to use it:</p><div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code>{#each arcs as arc, i}
<span class="nt">&lt;path</span> <span class="na">d=</span><span class="s">"{"</span> <span class="na">arc</span> <span class="err">}</span> <span class="na">fill=</span><span class="s">"{"</span> <span class="na">colors</span><span class="err">[</span><span class="na">i</span><span class="err">]</span> <span class="err">}</span> <span class="nt">/&gt;</span>
{/each}
</code></pre></div></div><p>The result should look like this:</p><p><img src="images/pie-colors-hardcoded.png" alt="" class="browser" data-url="http://localhost:5173/projects" /></p><p>Phew! 😮‍💨 Finally an actual pie chart!</p><p class="tip">While it does no harm, make sure to clean up your code by removing the <code class="language-plaintext highlighter-rouge">arc</code> variable we defined early on in this step, since we’re no longer using it.</p><p>Now let’s clean up the code a bit. D3 actually provides a higher level primitive for what we just did: the <a href="https://d3js.org/d3-shape/pie"><code class="language-plaintext highlighter-rouge">d3.pie()</code></a> function. Just like <code class="language-plaintext highlighter-rouge">d3.arc()</code>, <code class="language-plaintext highlighter-rouge">d3.pie()</code> is a function that returns another function, which we can use to generate the start and end angles for each slice in our pie chart instead of having to do it ourselves.</p><p>This …<em>slice generator</em> function takes an array of data values and returns an array of objects, each of whom represents a slice of the pie and contains the start and end angles for it. We still feed these objects to our <code class="language-plaintext highlighter-rouge">arcGenerator</code> to create the paths for the slices, but we don’t have to create them manually. It looks like this:</p><div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">let</span> <span class="nx">data</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">];</span>
<span class="kd">let</span> <span class="nx">sliceGenerator</span> <span class="o">=</span> <span class="nx">d3</span><span class="p">.</span><span class="nx">pie</span><span class="p">();</span>
<span class="kd">let</span> <span class="nx">arcData</span> <span class="o">=</span> <span class="nx">sliceGenerator</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
<span class="kd">let</span> <span class="nx">arcs</span> <span class="o">=</span> <span class="nx">arcData</span><span class="p">.</span><span class="nx">map</span><span class="p">((</span><span class="nx">d</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">arcGenerator</span><span class="p">(</span><span class="nx">d</span><span class="p">));</span>
</code></pre></div></div><h3 id="step-15-adding-more-data"> <a href="#step-15-adding-more-data" class="anchor-heading" aria-labelledby="step-15-adding-more-data"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Step 1.5: Adding more data</h3><p>Let’s tweak the <code class="language-plaintext highlighter-rouge">data</code> array to add some more numbers:</p><div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">let</span> <span class="nx">data</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">];</span>
</code></pre></div></div><p>Our pie chart did adapt, but all the new slices are black! They don’t even look like four new slices, but rather a huge black one. 😭</p><p><img src="/labs/lab06/images/pie-black.png" alt="alt text" /></p><p>This is because we’ve only specified colors for the first two slices. We <em>could</em> specify more colors, but this doesn’t scale. Thankfully, D3 comes with both ordinal and sequential color scales that can generate colors for us based on our data.</p><p>For example to use the <a href="https://d3js.org/d3-scale-chromatic/categorical#schemePaired"><code class="language-plaintext highlighter-rouge">schemePaired</code> color scale</a> we use the <a href="https://d3js.org/d3-scale/ordinal#scaleOrdinal"><code class="language-plaintext highlighter-rouge">d3.scaleOrdinal()</code></a> function with that as an argument:</p><div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">let</span> <span class="nx">colors</span> <span class="o">=</span> <span class="nx">d3</span><span class="p">.</span><span class="nx">scaleOrdinal</span><span class="p">(</span><span class="nx">d3</span><span class="p">.</span><span class="nx">schemeTableau10</span><span class="p">);</span>
</code></pre></div></div><p>We also need to change <code class="language-plaintext highlighter-rouge">colors[index]</code> to <code class="language-plaintext highlighter-rouge">colors(index)</code> in our template, since <code class="language-plaintext highlighter-rouge">colors</code> is now a function that takes an index and returns a color.</p><p>This is the result:</p><p><img src="images/pie-colors.png" alt="" class="browser" data-url="http://localhost:5173/projects" /></p><p>Success! 🎉</p><h2 id="step-2-adding-a-legend"> <a href="#step-2-adding-a-legend" class="anchor-heading" aria-labelledby="step-2-adding-a-legend"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Step 2: Adding a legend</h2><p>Our pie chart looks good, but there is no way to tell what each slice represents. Let’s fix that!</p><h3 id="step-21-adding-labels-to-our-data"> <a href="#step-21-adding-labels-to-our-data" class="anchor-heading" aria-labelledby="step-21-adding-labels-to-our-data"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Step 2.1: Adding labels to our data</h3><p>First, even our data does not know what it is — it does not include any labels, but only random quantities.</p><p>D3 allows us to specify more complex data, such as an array of objects:</p><div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">let</span> <span class="nx">data</span> <span class="o">=</span> <span class="p">[</span>
  <span class="p">{</span> <span class="na">value</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="na">label</span><span class="p">:</span> <span class="dl">'</span><span class="s1">apples</span><span class="dl">'</span> <span class="p">},</span>
  <span class="p">{</span> <span class="na">value</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="na">label</span><span class="p">:</span> <span class="dl">'</span><span class="s1">oranges</span><span class="dl">'</span> <span class="p">},</span>
  <span class="p">{</span> <span class="na">value</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="na">label</span><span class="p">:</span> <span class="dl">'</span><span class="s1">mangos</span><span class="dl">'</span> <span class="p">},</span>
  <span class="p">{</span> <span class="na">value</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span> <span class="na">label</span><span class="p">:</span> <span class="dl">'</span><span class="s1">pears</span><span class="dl">'</span> <span class="p">},</span>
  <span class="p">{</span> <span class="na">value</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span> <span class="na">label</span><span class="p">:</span> <span class="dl">'</span><span class="s1">limes</span><span class="dl">'</span> <span class="p">},</span>
  <span class="p">{</span> <span class="na">value</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span> <span class="na">label</span><span class="p">:</span> <span class="dl">'</span><span class="s1">cherries</span><span class="dl">'</span> <span class="p">},</span>
<span class="p">];</span>
</code></pre></div></div><p>However, to use this data, we need to change our <code class="language-plaintext highlighter-rouge">sliceGenerator</code> to tell it how to access the values in our data:</p><div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">let</span> <span class="nx">sliceGenerator</span> <span class="o">=</span> <span class="nx">d3</span><span class="p">.</span><span class="nx">pie</span><span class="p">().</span><span class="nx">value</span><span class="p">((</span><span class="nx">d</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">d</span><span class="p">.</span><span class="nx">value</span><span class="p">);</span>
</code></pre></div></div><p>If everything is set up correctly, you should now see the same pie chart as before.</p><h3 id="step-22-adding-a-legend"> <a href="#step-22-adding-a-legend" class="anchor-heading" aria-labelledby="step-22-adding-a-legend"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Step 2.2: Adding a legend</h3><p>The colors D3 scales return are just regular CSS colors. We can actually create a legend with plain HTML and CSS.</p><p>We can use a <code class="language-plaintext highlighter-rouge">&lt;ul&gt;</code> element, but a <code class="language-plaintext highlighter-rouge">&lt;dl&gt;</code> would have been fine too.</p><p>We use the same <code class="language-plaintext highlighter-rouge">{#each}</code> block to create a list item for each slice, and use a CSS variable (e.g. <code class="language-plaintext highlighter-rouge">--color</code>) to pass the color to CSS for styling.</p><div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;ul</span> <span class="na">class=</span><span class="s">"legend"</span><span class="nt">&gt;</span>
  {#each data as d, index}
  <span class="nt">&lt;li</span> <span class="na">style=</span><span class="s">"--color: { colors(index) }"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"swatch"</span><span class="nt">&gt;&lt;/span&gt;</span>
    {d.label} <span class="nt">&lt;em&gt;</span>({d.value})<span class="nt">&lt;/em&gt;</span>
  <span class="nt">&lt;/li&gt;</span>
  {/each}
<span class="nt">&lt;/ul&gt;</span>
</code></pre></div></div><p>At this point, it doesn’t look like a legend very much:</p><p><img src="/labs/lab06/images/legend-unstyled.png" alt="alt text" /></p><p>We need to add some CSS to make it look like an actual legend. You can experiment with the styles to make it look the way you want, but we’re including some tips below.</p><h4 id="making-the-swatch-look-like-a-swatch"> <a href="#making-the-swatch-look-like-a-swatch" class="anchor-heading" aria-labelledby="making-the-swatch-look-like-a-swatch"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Making the swatch look like a swatch</h4><p>You could probably want to make the swatch look like a swatch by:</p><ol><li>Making it a square by e.g. giving it the same width and height, or one the two plus <code class="language-plaintext highlighter-rouge">aspect-ratio: 1 / 1</code><li>Giving it a background color of <code class="language-plaintext highlighter-rouge">var(--color)</code><li>You may find <a href="https://developer.mozilla.org/en-US/docs/Web/CSS/border-radius"><code class="language-plaintext highlighter-rouge">border-radius</code></a> useful to add slight rounding to the corners or even make it into a full circle by setting it to <code class="language-plaintext highlighter-rouge">50%</code>.</ol><p class="tip">Note that because <code class="language-plaintext highlighter-rouge">&lt;span&gt;</code> is an inline element by default, to get widths and heights to work, you need to set it to <code class="language-plaintext highlighter-rouge">display: inline-block</code> or <code class="language-plaintext highlighter-rouge">inline-flex</code> (or apply <code class="language-plaintext highlighter-rouge">display: flex</code> or <code class="language-plaintext highlighter-rouge">display: grid</code> on its parent).</p><h4 id="applying-layout-on-the-list-to-make-it-look-like-a-legend"> <a href="#applying-layout-on-the-list-to-make-it-look-like-a-legend" class="anchor-heading" aria-labelledby="applying-layout-on-the-list-to-make-it-look-like-a-legend"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Applying layout on the list to make it look like a legend</h4><p>I applied <code class="language-plaintext highlighter-rouge">display: grid</code> to the <code class="language-plaintext highlighter-rouge">&lt;ul&gt;</code> (via suitable CSS rules). To make the grid make best use of available space, I used an <code class="language-plaintext highlighter-rouge">auto-fill</code> grid template, and set the <code class="language-plaintext highlighter-rouge">min-width</code> of the list items to a reasonable value.</p><div class="language-css highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">grid-template-columns</span><span class="o">:</span> <span class="nt">repeat</span><span class="o">(</span><span class="nt">auto-fill</span><span class="o">,</span> <span class="nt">minmax</span><span class="o">(</span><span class="err">9</span><span class="nt">em</span><span class="o">,</span> <span class="err">1</span><span class="nt">fr</span><span class="o">));</span>
</code></pre></div></div><p>This lays them all out on one line if there’s space, or multiple columns if not.</p><p>I also applied <code class="language-plaintext highlighter-rouge">display: flex</code> on each <code class="language-plaintext highlighter-rouge">&lt;li&gt;</code> (via suitable CSS rules) to vertically center align the text and the swatch (<code class="language-plaintext highlighter-rouge">align-items: center</code>) and give it spacing via <code class="language-plaintext highlighter-rouge">gap</code></p><p class="tip">Make sure the <code class="language-plaintext highlighter-rouge">gap</code> you specify for the <code class="language-plaintext highlighter-rouge">&lt;li&gt;</code>s is smaller than the <code class="language-plaintext highlighter-rouge">gap</code> you specify for the whole legend’s grid, to honor the <a href="https://www.nngroup.com/articles/gestalt-proximity/">design principle of <em>Proximity</em></a>.</p><hr /><p>You probably also want to specify a border around the legend, as well as spacing inside it (<code class="language-plaintext highlighter-rouge">padding</code>) and around it (<code class="language-plaintext highlighter-rouge">margin</code>). The final result will vary depending on your exact CSS, but this was mine:</p><p><img src="images/pie-legend.png" alt="" class="browser" data-url="http://localhost:5173/projects" /></p><h3 id="step-23-laying-out-our-pie-chart-and-legend-side-by-side"> <a href="#step-23-laying-out-our-pie-chart-and-legend-side-by-side" class="anchor-heading" aria-labelledby="step-23-laying-out-our-pie-chart-and-legend-side-by-side"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Step 2.3: Laying out our pie chart and legend side by side</h3><p>Right now, our pie chart and legend are occupying <em>a ton</em> of space on our page. It’s more common to place the legend to the right of the pie chart, so let’s do that.</p><p>We can do that by wrapping both the pie chart and the legend with a shared container, and using a flex layout on it.</p><div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"container"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;svg</span> <span class="na">viewBox=</span><span class="s">"-50 -50 100 100"</span><span class="nt">&gt;</span>
    <span class="c">&lt;!-- ... --&gt;</span>
  <span class="nt">&lt;/svg&gt;</span>
  <span class="nt">&lt;ul</span> <span class="na">class=</span><span class="s">"legend"</span><span class="nt">&gt;</span>
    <span class="c">&lt;!-- ... --&gt;</span>
  <span class="nt">&lt;/ul&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</code></pre></div></div><p>You can experiment with the horizontal alignment (<code class="language-plaintext highlighter-rouge">align-items</code>) and spacing (<code class="language-plaintext highlighter-rouge">gap</code>) of the pie chart and legend, but I would recommend applying <code class="language-plaintext highlighter-rouge">flex: 1</code> to the legend, so that it occupies all available width.</p><p>If everything worked well, you should now see the pie chart and legend side by side and it should be <em>responsive</em>, i.e. adapt well to changes in the viewport width.</p><video src="videos/responsive-legend.mp4" autoplay="" loop="" muted=""></video><h2 id="step-3-plotting-our-actual-data"> <a href="#step-3-plotting-our-actual-data" class="anchor-heading" aria-labelledby="step-3-plotting-our-actual-data"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Step 3: Plotting our actual data</h2><p>So far, we’ve been using meaningcless hardcoded data for our pie chart. Let’s change that and plot our actual project data, and namely projects per year.</p><h3 id="step-31-making-data-a-prop"> <a href="#step-31-making-data-a-prop" class="anchor-heading" aria-labelledby="step-31-making-data-a-prop"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Step 3.1: Making <code class="language-plaintext highlighter-rouge">data</code> a prop</h3><p>Hardcoding data within the pie component would give us a pie chart component that can only be used for one specific pie chart. That’s not very useful! Instead, we want to make <code class="language-plaintext highlighter-rouge">data</code> a <a href="https://svelte.dev/docs/svelte-components#script">prop</a> of the component, so we can pass it to the component from the page that uses it.</p><p>There are two parts to that change: First, changing our <code class="language-plaintext highlighter-rouge">data</code> declaration to an export (and its value to an empty array, which will be its default value):</p><div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">export</span> <span class="kd">let</span> <span class="nx">data</span> <span class="o">=</span> <span class="p">[];</span>
</code></pre></div></div><p>Then, we can pass the same data we’ve used in step 2.1 <strong>from our projects page this time</strong>, by first assigning them to a variable:</p><div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">let</span> <span class="nx">pieData</span> <span class="o">=</span> <span class="p">[</span>
  <span class="p">{</span> <span class="na">value</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="na">label</span><span class="p">:</span> <span class="dl">'</span><span class="s1">apples</span><span class="dl">'</span> <span class="p">},</span>
  <span class="p">{</span> <span class="na">value</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="na">label</span><span class="p">:</span> <span class="dl">'</span><span class="s1">oranges</span><span class="dl">'</span> <span class="p">},</span>
  <span class="p">{</span> <span class="na">value</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="na">label</span><span class="p">:</span> <span class="dl">'</span><span class="s1">mangos</span><span class="dl">'</span> <span class="p">},</span>
  <span class="p">{</span> <span class="na">value</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span> <span class="na">label</span><span class="p">:</span> <span class="dl">'</span><span class="s1">pears</span><span class="dl">'</span> <span class="p">},</span>
  <span class="p">{</span> <span class="na">value</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span> <span class="na">label</span><span class="p">:</span> <span class="dl">'</span><span class="s1">limes</span><span class="dl">'</span> <span class="p">},</span>
  <span class="p">{</span> <span class="na">value</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span> <span class="na">label</span><span class="p">:</span> <span class="dl">'</span><span class="s1">cherries</span><span class="dl">'</span> <span class="p">},</span>
<span class="p">];</span>
</code></pre></div></div><p>and then passing it to the <code class="language-plaintext highlighter-rouge">&lt;Pie&gt;</code> component:</p><div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;Pie</span> <span class="na">data=</span><span class="s">"{pieData}"</span> <span class="nt">/&gt;</span>
</code></pre></div></div><p>If everything worked well, we should now see the same pie chart (and legend) as before.</p><h3 id="step-32-passing-project-data-via-the-data-prop"> <a href="#step-32-passing-project-data-via-the-data-prop" class="anchor-heading" aria-labelledby="step-32-passing-project-data-via-the-data-prop"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Step 3.2: Passing project data via the <code class="language-plaintext highlighter-rouge">data</code> prop</h3><p>Now that we’re passing the data from the Projects page, let’s calculate the labels and values we’ll pass to the pie chart from our project data. We will be displaying a chart of projects per year, so the labels would be the years, and the values the count of projects for that year. But how to get from <a href="../4/#step-42-importing-our-project-data-into-our-projects-page">our project data</a> to that array?</p><p>D3 does not only provide functions to generate visual output, but includes powerful helpers for manipulating data. In this case, we’ll use the <code class="language-plaintext highlighter-rouge">d3.rollups()</code> function to group our projects by year and count the number of projects in each bucket:</p><div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">let</span> <span class="nx">rolledData</span> <span class="o">=</span> <span class="nx">d3</span><span class="p">.</span><span class="nx">rollups</span><span class="p">(</span>
  <span class="nx">projects</span><span class="p">,</span>
  <span class="p">(</span><span class="nx">v</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">v</span><span class="p">.</span><span class="nx">length</span><span class="p">,</span>
  <span class="p">(</span><span class="nx">d</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">d</span><span class="p">.</span><span class="nx">year</span><span class="p">,</span>
<span class="p">);</span>
</code></pre></div></div><p>This will give us an array of arrays that looks like this:</p><div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">[</span>
  <span class="p">[</span><span class="dl">'</span><span class="s1">2024</span><span class="dl">'</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span>
  <span class="p">[</span><span class="dl">'</span><span class="s1">2023</span><span class="dl">'</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span>
  <span class="p">[</span><span class="dl">'</span><span class="s1">2022</span><span class="dl">'</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span>
  <span class="p">[</span><span class="dl">'</span><span class="s1">2021</span><span class="dl">'</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span>
<span class="p">];</span>
</code></pre></div></div><p>We will then convert this array to the type of array we need by using <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/map"><code class="language-plaintext highlighter-rouge">array.map()</code></a>. Replace your previous <code class="language-plaintext highlighter-rouge">pieData</code> declaration with:</p><div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">let</span> <span class="nx">pieData</span> <span class="o">=</span> <span class="nx">rolledData</span><span class="p">.</span><span class="nx">map</span><span class="p">(([</span><span class="nx">year</span><span class="p">,</span> <span class="nx">count</span><span class="p">])</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">return</span> <span class="p">{</span> <span class="na">value</span><span class="p">:</span> <span class="nx">count</span><span class="p">,</span> <span class="na">label</span><span class="p">:</span> <span class="nx">year</span> <span class="p">};</span>
<span class="p">});</span>
</code></pre></div></div><p>That’s it! The result should look like this:</p><p><img src="images/pie-project-year.png" alt="" class="browser" data-url="http://localhost:5173/projects" /></p><h2 id="step-4-adding-a-search-for-our-projects-and-only-visualizing-visible-projects"> <a href="#step-4-adding-a-search-for-our-projects-and-only-visualizing-visible-projects" class="anchor-heading" aria-labelledby="step-4-adding-a-search-for-our-projects-and-only-visualizing-visible-projects"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Step 4: Adding a search for our projects and only visualizing visible projects</h2><p>At first glance, this step appears a little unrelated to the rest of this lab. However, it demonstrates how these visualizations don’t have to be static, but can <em>reactively update with the data</em>, a point we will develop further in the next lab.</p><h3 id="step-41-adding-a-search-field"> <a href="#step-41-adding-a-search-field" class="anchor-heading" aria-labelledby="step-41-adding-a-search-field"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Step 4.1: Adding a search field</h3><p>First, declare a variable that will hold the search query in the <code class="language-plaintext highlighter-rouge">&lt;script&gt;</code> element of your projects page:</p><div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">let</span> <span class="nx">query</span> <span class="o">=</span> <span class="dl">''</span><span class="p">;</span>
</code></pre></div></div><p>Then, add an <code class="language-plaintext highlighter-rouge">&lt;input type="search"&gt;</code> to the HTML, and bind its value to that variable:</p><div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;input</span>
  <span class="na">type=</span><span class="s">"search"</span>
  <span class="na">bind:value=</span><span class="s">"{query}"</span>
  <span class="na">aria-label=</span><span class="s">"Search projects"</span>
  <span class="na">placeholder=</span><span class="s">"🔍 Search projects…"</span>
<span class="nt">/&gt;</span>
</code></pre></div></div><p class="tip">As usual, you can print out the variable in your HTML via <code class="language-plaintext highlighter-rouge">{query}</code> to make sure the binding works as expected.</p><h3 id="step-42-basic-search-functionality"> <a href="#step-42-basic-search-functionality" class="anchor-heading" aria-labelledby="step-42-basic-search-functionality"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Step 4.2: Basic search functionality</h3><p>This is the same regardless of whether you have implemented <a href="../../4/#step-7-creating-a-project-list-component-optional">Step 7 of Lab 4</a> or not, since we’ll be filtering the projects by changing the data that we are displaying.</p><p>However, in Lab 4 we avoided having to change our single project template by doing</p><div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">let</span> <span class="nx">p</span> <span class="o">=</span> <span class="nx">info</span><span class="p">;</span>
</code></pre></div></div><p>Since in this step we will be reactively updating the projects displayed, it’s time to actually <strong>delete that alias</strong> and edit our expressions to use the actual prop name (e.g. use <code class="language-plaintext highlighter-rouge">info.title</code> instead of <code class="language-plaintext highlighter-rouge">p.title</code>).</p><p>To filter the project data, we will use the <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/filter"><code class="language-plaintext highlighter-rouge">array.filter()</code></a> function, which returns a new array containing only the elements that pass the test implemented by the provided function.</p><p>For example, this is how we’d search in project titles:</p><div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">let</span> <span class="nx">filteredProjects</span> <span class="o">=</span> <span class="nx">projects</span><span class="p">.</span><span class="nx">filter</span><span class="p">((</span><span class="nx">project</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">query</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">project</span><span class="p">.</span><span class="nx">title</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="nx">query</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
<span class="p">});</span>
</code></pre></div></div><p class="fyi"><code class="language-plaintext highlighter-rouge">return project.title.includes(query);</code> by itself would have actually worked fine, since if the query is <code class="language-plaintext highlighter-rouge">""</code>, then every project title contains it anyway. However, there is no reason to do extra work if we don’t have to.</p><p>For this to work, we’d need to use <code class="language-plaintext highlighter-rouge">filteredProjects</code> instead of <code class="language-plaintext highlighter-rouge">projects</code> in our template that displays the projects.</p><p>If you try this out, you’ll notice that no filtering is actually happening. This is because we are only executing the filtering once, when our search query is empty</p><p>For the filtering to re-run whenever the query changes, we need to make it a <a href="https://svelte.dev/tutorial/reactive-statements"><em>reactive statement</em></a> by using the <a href="https://svelte.dev/tutorial/reactive-statements"><code class="language-plaintext highlighter-rouge">$:</code> prefix</a>:</p><div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">let</span> <span class="nx">filteredProjects</span><span class="p">;</span>
<span class="nl">$</span><span class="p">:</span> <span class="nx">filteredProjects</span> <span class="o">=</span> <span class="nx">projects</span><span class="p">.</span><span class="nx">filter</span><span class="p">((</span><span class="nx">project</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">query</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">project</span><span class="p">.</span><span class="nx">title</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="nx">query</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
<span class="p">});</span>
</code></pre></div></div><p>If you try it now, filtering should work!</p><video src="videos/search-titles.mp4" autoplay="" muted="" loop=""></video><h3 id="step-43-improving-the-search"> <a href="#step-43-improving-the-search" class="anchor-heading" aria-labelledby="step-43-improving-the-search"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Step 4.3: Improving the search</h3><p>Finding projects by title is a good first step, but it could make it hard to find a project. Also, it’s case-sensitive, so e.g. searching for “svelte” won’t find “Svelte”.</p><p>Let’s fix both of these!</p><h4 id="make-the-search-case-insensitive"> <a href="#make-the-search-case-insensitive" class="anchor-heading" aria-labelledby="make-the-search-case-insensitive"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Make the search case-insensitive</h4><p>To do this, we can simply convert <em>both</em> the query and the title to lowercase before comparing them by using the <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String/toLowerCase"><code class="language-plaintext highlighter-rouge">string.toLowerCase()</code></a> function:</p><div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">$</span><span class="p">:</span> <span class="nx">filteredProjects</span> <span class="o">=</span> <span class="nx">projects</span><span class="p">.</span><span class="nx">filter</span><span class="p">((</span><span class="nx">project</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">query</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">project</span><span class="p">.</span><span class="nx">title</span><span class="p">.</span><span class="nx">toLowerCase</span><span class="p">().</span><span class="nx">includes</span><span class="p">(</span><span class="nx">query</span><span class="p">.</span><span class="nx">toLowerCase</span><span class="p">());</span>
  <span class="p">}</span>

  <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
<span class="p">});</span>
</code></pre></div></div><h4 id="search-across-all-project-metadata-not-just-titles"> <a href="#search-across-all-project-metadata-not-just-titles" class="anchor-heading" aria-labelledby="search-across-all-project-metadata-not-just-titles"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Search across all project metadata, not just titles</h4><p>For the second, we can use the <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_objects/Object/values"><code class="language-plaintext highlighter-rouge">Object.values()</code></a> function to get an array of all the values of a project, and then join them into a single string, which we can then search in the same way:</p><div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">$</span><span class="p">:</span> <span class="nx">filteredProjects</span> <span class="o">=</span> <span class="nx">projects</span><span class="p">.</span><span class="nx">filter</span><span class="p">((</span><span class="nx">project</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">let</span> <span class="nx">values</span> <span class="o">=</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">values</span><span class="p">(</span><span class="nx">project</span><span class="p">).</span><span class="nx">join</span><span class="p">(</span><span class="dl">'</span><span class="se">\n</span><span class="dl">'</span><span class="p">).</span><span class="nx">toLowerCase</span><span class="p">();</span>
  <span class="k">return</span> <span class="nx">values</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="nx">query</span><span class="p">.</span><span class="nx">toLowerCase</span><span class="p">());</span>
<span class="p">});</span>
</code></pre></div></div><p>Try it again. Both issues should be fixed at this point.</p><video src="videos/search-titles.mp4" autoplay="" muted="" loop=""></video><h3 id="step-44-visualizing-only-visible-projects"> <a href="#step-44-visualizing-only-visible-projects" class="anchor-heading" aria-labelledby="step-44-visualizing-only-visible-projects"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Step 4.4: Visualizing only visible projects</h3><p>As it currently stands, our pie chart and legend are not aware of the filtering we are doing. Wouldn’t it be cool if we could see stats <em>only</em> about the projects we are currently seeing?</p><p>There are two components to this:</p><ol><li>Calculate <code class="language-plaintext highlighter-rouge">pieData</code> based on <code class="language-plaintext highlighter-rouge">filteredProjects</code> instead of <code class="language-plaintext highlighter-rouge">projects</code><li>Make it update reactively.</ol><p>The former is a simple matter of replacing the variable name used in your projects page **from <code class="language-plaintext highlighter-rouge">projects</code> to <code class="language-plaintext highlighter-rouge">filteredProjects</code>. The second does involve something we have not yet done: how do we turn something that consists of several lines into a reactive statement? So far we’ve only been prepending single commands with <code class="language-plaintext highlighter-rouge">$:</code>!</p><p>The answer is that we can use a block statement (<code class="language-plaintext highlighter-rouge">{}</code>) to contain multiple commands, and then prepend <em>that</em> with <code class="language-plaintext highlighter-rouge">$:</code>:</p><div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Make sure the variable definition is *outside* the block</span>
<span class="kd">let</span> <span class="nx">pieData</span><span class="p">;</span>

<span class="nl">$</span><span class="p">:</span> <span class="p">{</span>
  <span class="c1">// Initialize to an empty object every time this runs</span>
  <span class="nx">pieData</span> <span class="o">=</span> <span class="p">{};</span>

  <span class="c1">// Calculate rolledData and pieData based on filteredProjects here</span>
<span class="p">}</span>
</code></pre></div></div><p>If you try the search out at this point, you will see that the legend is updating, but the pie chart is not.</p><video src="videos/legend-reactive.mp4" autoplay="" muted="" loop=""></video><p>This is because none of the calculations in the <code class="language-plaintext highlighter-rouge">&lt;Pie&gt;</code> component are actually reactive. We need to make them reactive by separating the variable declarations from the value calculations and using the <code class="language-plaintext highlighter-rouge">$:</code> prefix on the latter.</p><p>This only applies to <code class="language-plaintext highlighter-rouge">arcData</code> and <code class="language-plaintext highlighter-rouge">arcs</code>, since none of the rest needs to actually change.</p><p>Once we do that, our pie chart becomes beautifully reactive as well:</p><video src="videos/pie-reactive.mp4" autoplay="" muted="" loop=""></video><h2 id="step-5-turning-the-pie-into-filtering-ui-for-our-projects"> <a href="#step-5-turning-the-pie-into-filtering-ui-for-our-projects" class="anchor-heading" aria-labelledby="step-5-turning-the-pie-into-filtering-ui-for-our-projects"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Step 5: Turning the pie into filtering UI for our projects</h2><p><strong>Visualizations are not just output.</strong> Interactive visualizations allow you to <em>interact</em> with the data as well and explore it more effective ways.</p><p>In this step, we will turn our pie chart into a filtering UI for our projects, so we can click on the wedge or legend entry for a given year and only see projects from that year.</p><p>It will work a bit like this:</p><video src="videos/year-filter-final.mp4" autoplay="" loop="" muted=""></video><p>Ready? Let’s go!</p><h3 id="step-51-highlighting-hovered-wedge"> <a href="#step-51-highlighting-hovered-wedge" class="anchor-heading" aria-labelledby="step-51-highlighting-hovered-wedge"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Step 5.1: Highlighting hovered wedge</h3><p>While there are some differences, SVG elements are still DOM elements. This means they can be styled with regular CSS, although the available properties are not all the same.</p><p>Let’s start by adding a hover effect to the wedges. What about fading out all <em>other</em> wedges when a wedge is hovered? We can target the <code class="language-plaintext highlighter-rouge">&lt;svg&gt;</code> element when it contains a hovered <code class="language-plaintext highlighter-rouge">&lt;path&gt;</code> by using the <code class="language-plaintext highlighter-rouge">:has()</code> pseudo-class:</p><div class="language-scss highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">svg</span><span class="nd">:has</span><span class="o">(</span><span class="nt">path</span><span class="nd">:hover</span><span class="o">)</span> <span class="p">{</span>
  <span class="nt">path</span><span class="nd">:not</span><span class="o">(</span><span class="nd">:hover</span><span class="o">)</span> <span class="p">{</span>
    <span class="nl">opacity</span><span class="p">:</span> <span class="m">50%</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div><p>This gives us something like this:</p><p><img src="/labs/lab06/images/wedge-hover-1.gif" alt="" /></p><p class="fyi">Why not just use <code class="language-plaintext highlighter-rouge">svg:hover</code> instead of <code class="language-plaintext highlighter-rouge">svg:has(path:hover)</code>? Because the <code class="language-plaintext highlighter-rouge">&lt;svg&gt;</code> can be covered <em>without</em> any of the wedges being hovered, and then <em>all</em> wedges would be faded out.</p><p>We can even make it smooth by adding a <code class="language-plaintext highlighter-rouge">transition</code> property to the <code class="language-plaintext highlighter-rouge">&lt;path&gt;</code> elements:</p><div class="language-css highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">path</span> <span class="p">{</span>
  <span class="nl">transition</span><span class="p">:</span> <span class="m">300ms</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div><p>Which would look like this:</p><figure class="multiple stretch"> <img src="images/wedge-hover-1.gif" alt="" class="no-link" /> <img src="images/wedge-hover-2.gif" alt="" class="no-link" /><figcaption>Before (left) and after (right) adding the transition</figcaption></figure><h3 class="tbd" id="step-52-highlighting-selected-wedge"> <a href="#step-52-highlighting-selected-wedge" class="anchor-heading" aria-labelledby="step-52-highlighting-selected-wedge"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Step 5.2: Highlighting selected wedge</h3><p>In this step, we will be able to click on a wedge and have it stay highlighted. Its color will change to indicate that it’s highlighted, and its legend item will also be highlighted. Pages using the component should be able to read what the selected wedge is, if any. Clicking on a selected wedge should deselect it.</p><video src="videos/wedge-select.mp4" loop="" autoplay="" muted=""></video><p>First, create a <code class="language-plaintext highlighter-rouge">selectedIndex</code> prop and initialize it to <code class="language-plaintext highlighter-rouge">-1</code> (a convention to mean “no index”):</p><div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">export</span> <span class="kd">let</span> <span class="nx">selectedIndex</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
</code></pre></div></div><p>Then, add an <code class="language-plaintext highlighter-rouge">on:click</code> event on your <code class="language-plaintext highlighter-rouge">&lt;path&gt;</code> to set it to the index of the wedge that was clicked:</p><div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code>{#each arcs as arc, index} <span class="nt">&lt;path</span> <span class="na">d=</span><span class="s">{arc}</span> <span class="na">fill=</span><span class="s">{</span> <span class="na">colors</span><span class="err">(</span><span class="na">index</span><span class="err">)</span> <span class="err">}</span> <span class="na">on:click=</span><span class="s">{e</span> <span class="err">=</span><span class="nt">&gt;</span>
selectedIndex = index} /&gt; {/each}
</code></pre></div></div><p>Ignore the accessibility warnings for now, we will address them at the end.</p><p>Right now, there is no observable difference when we click on a wedge, since we’re not doing anything with the <code class="language-plaintext highlighter-rouge">selectedIndex</code>. Let’s use it to conditionally apply a <code class="language-plaintext highlighter-rouge">selected</code> class, that we can then use in our CSS to style selected wedges differently:</p><div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code>{#each arcs as arc, index} <span class="nt">&lt;path</span> <span class="na">d=</span><span class="s">{arc}</span> <span class="na">fill=</span><span class="s">{</span> <span class="na">colors</span><span class="err">(</span><span class="na">index</span><span class="err">)</span> <span class="err">}</span>
<span class="na">class:selected=</span><span class="s">{selectedIndex</span> <span class="err">===</span> <span class="na">index</span><span class="err">}</span> <span class="na">on:click=</span><span class="s">{e</span> <span class="err">=</span><span class="nt">&gt;</span> selectedIndex = index}
/&gt; {/each}
</code></pre></div></div><p>You can apply the exact same <code class="language-plaintext highlighter-rouge">class:selected</code> directive to conditionally apply a <code class="language-plaintext highlighter-rouge">selected</code> class to the legend items as well.</p><p>Then let’s apply CSS to change the color of the selected wedge and legend item:</p><div class="language-scss highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">.selected</span> <span class="p">{</span>
  <span class="na">--color</span><span class="p">:</span> <span class="nf">oklch</span><span class="p">(</span><span class="m">60%</span> <span class="m">45%</span> <span class="m">0</span><span class="p">)</span> <span class="o">!</span><span class="n">important</span><span class="p">;</span>

  <span class="k">&amp;</span><span class="nd">:is</span><span class="o">(</span><span class="nt">path</span><span class="o">)</span> <span class="p">{</span>
    <span class="na">fill</span><span class="p">:</span> <span class="nf">var</span><span class="p">(</span><span class="o">--</span><span class="n">color</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div><p>Feel free to use any color you want, as long as it’s disctinct from the actual wedge colors.</p><p class="fyi">Why the <code class="language-plaintext highlighter-rouge">!important</code>? Because we are trying to override the <code class="language-plaintext highlighter-rouge">--color</code> variable set via the <code class="language-plaintext highlighter-rouge">style</code> attribute, which has higher precedence than any selector.</p><p>Lastly, we want to be able to deselect a wedge by clicking on it again.</p><p>This is as simple as setting <code class="language-plaintext highlighter-rouge">selectedIndex</code> to <code class="language-plaintext highlighter-rouge">-1</code> if it’s already the index of the selected wedge, i.e. changing the assignment to</p><div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">selectedIndex</span> <span class="o">=</span> <span class="nx">selectedIndex</span> <span class="o">===</span> <span class="nx">index</span> <span class="p">?</span> <span class="o">-</span><span class="mi">1</span> <span class="p">:</span> <span class="nx">index</span><span class="p">;</span>
</code></pre></div></div><blockquote class="tip"><p>You can improve UX by indicating that a wedge is clickable through the cursor:</p><div class="language-css highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">path</span> <span class="p">{</span>
  <span class="c">/* ... */</span>
  <span class="nl">cursor</span><span class="p">:</span> <span class="nb">pointer</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div></blockquote><h3 id="step-53-filtering-the-projects-by-the-selected-year"> <a href="#step-53-filtering-the-projects-by-the-selected-year" class="anchor-heading" aria-labelledby="step-53-filtering-the-projects-by-the-selected-year"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Step 5.3: Filtering the projects by the selected year</h3><p>Selecting a wedge doesn’t really do that much right now. However, the ability to select a wedge becomes truly powerful when handled by the parent page.</p><p>In <code class="language-plaintext highlighter-rouge">src/routes/projects/+page.svelte</code>, add a variable to hold the selected index:</p><div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">let</span> <span class="nx">selectedYearIndex</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
</code></pre></div></div><p>Then bind it to the <code class="language-plaintext highlighter-rouge">&lt;Pie&gt;</code> component’s <code class="language-plaintext highlighter-rouge">selectedIndex</code> prop:</p><div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;Pie</span> <span class="na">data=</span><span class="s">"{pieData}"</span> <span class="na">bind:selectedIndex=</span><span class="s">"{selectedYearIndex}"</span> <span class="nt">/&gt;</span>
</code></pre></div></div><p>Make sure that it works by printing out the selected index in an expression (<code class="language-plaintext highlighter-rouge">{selectedYearIndex}</code>) somewhere on the page.</p><video src="videos/selected-year-index.mp4" autoplay="" loop="" muted=""></video><p>Now define a reactive variable to hold the selected <em>year</em>:</p><div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">let</span> <span class="nx">selectedYear</span><span class="p">;</span>
<span class="nl">$</span><span class="p">:</span> <span class="nx">selectedYear</span> <span class="o">=</span>
  <span class="nx">selectedYearIndex</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span> <span class="p">?</span> <span class="nx">pieData</span><span class="p">[</span><span class="nx">selectedYearIndex</span><span class="p">].</span><span class="nx">label</span> <span class="p">:</span> <span class="kc">null</span><span class="p">;</span>
</code></pre></div></div><p>Similarly, print it out somewhere on the page to make sure it works before proceeding.</p><p>Now that we have the selected year, we can filter the projects by it!</p><p>Our first thought might be to do this filtering by adding another conditional in our <code class="language-plaintext highlighter-rouge">array.filter()</code> call from Step 4:</p><div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">$</span><span class="p">:</span> <span class="nx">filteredProjects</span> <span class="o">=</span> <span class="nx">projects</span><span class="p">.</span><span class="nx">filter</span><span class="p">((</span><span class="nx">project</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">query</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// ...</span>
  <span class="p">}</span>

  <span class="k">if</span> <span class="p">(</span><span class="nx">selectedYear</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">project</span><span class="p">.</span><span class="nx">year</span> <span class="o">===</span> <span class="nx">selectedYear</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
<span class="p">});</span>
</code></pre></div></div><p>However, this will produce an error:</p><p><img src="/labs/lab06/images/cyclical-dependency-error.png" alt="" /></p><p>But even if it worked, it would make for some pretty jarring user experience: because we are using the same <code class="language-plaintext highlighter-rouge">filteredProjects</code> variable for the pie chart as well, it would make all other years disappear from the pie chart when a year is selected. The only way to select another year would be to deselect the current one.</p><p>Instead, we should use <em>another</em> variable to hold the result of that filtering, e.g. <code class="language-plaintext highlighter-rouge">filteredByYear</code>.</p><p>Then, use <code class="language-plaintext highlighter-rouge">filteredByYear</code> in your template where you are displaying the actual projects, but leave <code class="language-plaintext highlighter-rouge">filteredProjects</code> as it is for the pie chart.</p><p>That’s it! It should work now.</p><video src="videos/year-filter-final.mp4" autoplay="" loop="" muted="" class="browser"></video><h3 id="step-54-fixing-accessibility-issues-optional-but-strongly-recommended"> <a href="#step-54-fixing-accessibility-issues-optional-but-strongly-recommended" class="anchor-heading" aria-labelledby="step-54-fixing-accessibility-issues-optional-but-strongly-recommended"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Step 5.4: Fixing accessibility issues (Optional, but strongly recommended)</h3><p>Now that we got the basic functionality working, let’s address the accessibility warnings.</p><p>It’s important to understand why these warnings are there. The <code class="language-plaintext highlighter-rouge">path</code> elements are not focusable by default, so they cannot be interacted with using the keyboard. This means that as it currently stands, people who cannot use a mouse or other pointing device cannot select a wedge. Even users who <em>can</em> use a mouse, often find keyboard interactions more convenient (e.g. imagine filling out a form by clicking on each field with the mouse instead of pressing <kbd>Tab</kbd>!).</p><p>So how do we fix this? The first step is making it possible to interact with these wedges with the keyboard at all. Right now, you cannot even select a wedge by pressing the <kbd>Tab</kbd> key on your keyboard, because they are not <em>focusable</em>.</p><p>We can fix this by adding a few attributes to the <code class="language-plaintext highlighter-rouge">&lt;path&gt;</code> elements:</p><ul><li>Make it focusable, by adding <a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Global_attributes/tabindex"><code class="language-plaintext highlighter-rouge">tabindex="0"</code></a><li>Expose it as a button to assistive technology, by adding <a href="https://developer.mozilla.org/en-US/docs/Web/Accessibility/ARIA/Roles"><code class="language-plaintext highlighter-rouge">role="button"</code></a><li>Adding a label via <a href="https://developer.mozilla.org/en-US/docs/Web/Accessibility/ARIA/Attributes/aria-label"><code class="language-plaintext highlighter-rouge">aria-label</code></a></ul><p>We’re not done yet. All that these do is to make sure users of assistive technology can actually interact with the wedge. However, because it’s not a native button or link, the <code class="language-plaintext highlighter-rouge">click</code> event will not be triggered when the user focuses on the wedge with the keyboard and presses <code class="language-plaintext highlighter-rouge">Enter</code> or <code class="language-plaintext highlighter-rouge">Space</code>. Instead, we need to enable that, via a separate event listener (<code class="language-plaintext highlighter-rouge">keyup</code> is a good candidate).</p><p>To avoid duplicating code, let’s move the code that selects a wedge into a separate function:</p><div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">function</span> <span class="nx">toggleWedge</span><span class="p">(</span><span class="nx">index</span><span class="p">,</span> <span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">selectedIndex</span> <span class="o">=</span> <span class="nx">index</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div><p>Then replace <code class="language-plaintext highlighter-rouge">on:click={e =&gt; selectedIndex = index}</code> with <code class="language-plaintext highlighter-rouge">on:click={e =&gt; toggleWedge(index, e)}</code>. Now add a keyboard event listener: <code class="language-plaintext highlighter-rouge">on:keyup={e =&gt; toggleWedge(index, e)}</code>.</p><p>In the <code class="language-plaintext highlighter-rouge">toggleWedge</code> function, we can wrap the code that selects the wedge with a conditional that checks that either <code class="language-plaintext highlighter-rouge">event.key</code> doesn’t exist, or if it does, that it is <code class="language-plaintext highlighter-rouge">Enter</code>:</p><div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">function</span> <span class="nx">toggleWedge</span><span class="p">(</span><span class="nx">index</span><span class="p">,</span> <span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">event</span><span class="p">.</span><span class="nx">key</span> <span class="o">||</span> <span class="nx">event</span><span class="p">.</span><span class="nx">key</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">Enter</span><span class="dl">'</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">selectedIndex</span> <span class="o">=</span> <span class="nx">index</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div><p>If you try the keyboard interaction out you will notice that it works, but even when we are interacting with it via the mouse, we get an unwieldy focus ring around the wedge which looks awful since it’s actually covered by the other wedges:</p><p><img src="/labs/lab06/images/wedge-outline.png" alt="" /></p><p>We can hide that with <code class="language-plaintext highlighter-rouge">outline: none</code>:</p><div class="language-css highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">path</span> <span class="p">{</span>
  <span class="nl">transition</span><span class="p">:</span> <span class="m">300ms</span><span class="p">;</span>
  <span class="nl">outline</span><span class="p">:</span> <span class="nb">none</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div><p>However, now keyboard users have no way to know which wedge they have currently focused, which is a terrible user experience. <strong>Never, ever remove the browser’s default focus styles without providing alternative focus styles</strong>. Often extending <code class="language-plaintext highlighter-rouge">:hover</code> styles to cover <a href="https://developer.mozilla.org/en-US/docs/Web/CSS/:focus-visible"><code class="language-plaintext highlighter-rouge">:focus-visible</code></a> as well is a good start. So let’s extend our previous <code class="language-plaintext highlighter-rouge">:hover</code> effect to keyboard users as well:</p><div class="language-scss highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">svg</span><span class="nd">:has</span><span class="o">(</span><span class="nt">path</span><span class="nd">:hover</span><span class="o">,</span> <span class="nt">path</span><span class="nd">:focus-visible</span><span class="o">)</span> <span class="p">{</span>
  <span class="nt">path</span><span class="nd">:not</span><span class="o">(</span><span class="nd">:hover</span><span class="o">,</span> <span class="nd">:focus-visible</span><span class="o">)</span> <span class="p">{</span>
    <span class="nl">opacity</span><span class="p">:</span> <span class="m">50%</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div><p>If you try out the keyboard interaction now, you will notice that we are getting a visible indication of focus, and that the unwieldy default focus ring is no longer visible. Yay! 🎉</p><h3 id="step-55-better-selected-wedge-styling-optional"> <a href="#step-55-better-selected-wedge-styling-optional" class="anchor-heading" aria-labelledby="step-55-better-selected-wedge-styling-optional"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Step 5.5: Better selected wedge styling (Optional)</h3><p>We are currently only indicating which wedge is selected by its <em>color</em>, which is a little confusing (not to mention problematic for colorblind users), since that could be just another color in the pie chart.</p><p>The reason we went with that is that it’s easier than pretty much any alternative, but if you want to go further, we can do it in a better way.</p><p>First, it’s important to understand something about SVG:</p><p class="important">Shapes are painted in the order they appear in the source code, and unlike in HTML, there is no way to change this order with CSS.</p><p>This means that decorations like <a href="https://developer.mozilla.org/en-US/docs/Web/SVG/Attribute/stroke">strokes</a> or <a href="https://developer.mozilla.org/en-US/docs/Web/CSS/filter">shadows</a> will work nicely for one of the wedges and fail miserably for the others:</p><video src="videos/stroke-yikes.mp4" autoplay="" loop="" muted=""></video><p>Yikes on bikes! So what can we do?</p><p>A common technique is to <em>move</em> the selected wedge to the very end with JS or make a copy, then style that. But we’ll try something different: we’ll move the selected slice outwards a bit, and make it a bit bigger, like taking a pizza slice from a large colorful pizza. It will look like this:</p><video src="videos/pizza-slice-final.mp4" autoplay="" loop="" muted=""></video><p>We will need the start and end angles in our CSS, so the first step is to pass them in as CSS variables:</p><div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;path</span> <span class="na">d=</span><span class="s">{arc}</span> <span class="na">style=</span><span class="s">"
	--start-angle: { arcData[index]?.startAngle }rad;
	--end-angle: { arcData[index]?.endAngle }rad;"</span>
</code></pre></div></div><p class="important">Note the <code class="language-plaintext highlighter-rouge">rad</code> at the end: CSS angles need a unit too.</p><p>Then, in the CSS we can calculate the difference, and the angle to get to the midpoint of the arc:</p><div class="language-scss highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">path</span> <span class="p">{</span>
  <span class="na">--angle</span><span class="p">:</span> <span class="nf">calc</span><span class="p">(</span><span class="nf">var</span><span class="p">(</span><span class="o">--</span><span class="n">end-angle</span><span class="p">)</span> <span class="o">-</span> <span class="nf">var</span><span class="p">(</span><span class="o">--</span><span class="n">start-angle</span><span class="p">));</span>
  <span class="na">--mid-angle</span><span class="p">:</span> <span class="nf">calc</span><span class="p">(</span><span class="nf">var</span><span class="p">(</span><span class="o">--</span><span class="n">start-angle</span><span class="p">)</span> <span class="o">+</span> <span class="nf">var</span><span class="p">(</span><span class="o">--</span><span class="n">angle</span><span class="p">)</span> <span class="o">/</span> <span class="m">2</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div><p>Now comes the fun part: We will use the <code class="language-plaintext highlighter-rouge">transform</code> property to rotate to the midpoint of the arc (so that we move along that angle), move by 6, then rotate back to restore the original orientation:</p><div class="language-scss highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">path</span> <span class="p">{</span>
  <span class="na">--angle</span><span class="p">:</span> <span class="nf">calc</span><span class="p">(</span><span class="nf">var</span><span class="p">(</span><span class="o">--</span><span class="n">end-angle</span><span class="p">)</span> <span class="o">-</span> <span class="nf">var</span><span class="p">(</span><span class="o">--</span><span class="n">start-angle</span><span class="p">));</span>
  <span class="na">--mid-angle</span><span class="p">:</span> <span class="nf">calc</span><span class="p">(</span><span class="nf">var</span><span class="p">(</span><span class="o">--</span><span class="n">start-angle</span><span class="p">)</span> <span class="o">+</span> <span class="nf">var</span><span class="p">(</span><span class="o">--</span><span class="n">angle</span><span class="p">)</span> <span class="o">/</span> <span class="m">2</span><span class="p">);</span>

  <span class="k">&amp;</span><span class="nc">.selected</span> <span class="p">{</span>
    <span class="nl">transform</span><span class="p">:</span> <span class="nf">rotate</span><span class="p">(</span><span class="nf">var</span><span class="p">(</span><span class="o">--</span><span class="n">mid-angle</span><span class="p">))</span> <span class="nf">translateY</span><span class="p">(</span><span class="m">-6px</span><span class="p">)</span> <span class="nf">rotate</span><span class="p">(</span><span class="nf">calc</span><span class="p">(</span><span class="m">-1</span> <span class="o">*</span> <span class="nf">var</span><span class="p">(</span><span class="o">--</span><span class="n">mid-angle</span><span class="p">)));</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div><p>If you try it, it should work, even if a little rough around the edges:</p><video src="videos/pizza-slice-1.mp4" autoplay="" loop="" muted=""></video><figure> <video src="videos/transforms-explained.mp4" autoplay="" loop="" muted=""></video><figcaption> To better understand what this is doing, let’s break it down, by showing the rotate, move, and rotate back one after the other</figcaption></figure><p>The reason it’s a little janky when we click on it, is that it’s transitioning all three transforms at once. If we apply a transform on its non-selected state as well, we can fix that:</p><div class="language-scss highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">path</span> <span class="p">{</span>
  <span class="nl">transform</span><span class="p">:</span> <span class="nf">rotate</span><span class="p">(</span><span class="nf">var</span><span class="p">(</span><span class="o">--</span><span class="n">mid-angle</span><span class="p">))</span> <span class="nf">translateY</span><span class="p">(</span><span class="m">0</span><span class="p">)</span> <span class="nf">rotate</span><span class="p">(</span><span class="nf">calc</span><span class="p">(</span><span class="m">-1</span> <span class="o">*</span> <span class="nf">var</span><span class="p">(</span><span class="o">--</span><span class="n">mid-angle</span><span class="p">)));</span>
  <span class="cm">/* ... */</span>
<span class="p">}</span>
</code></pre></div></div><p>And let’s also make it a little bigger, by adding a <code class="language-plaintext highlighter-rouge">scale(1.1)</code> transform as well:</p><div class="language-css highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&amp;</span><span class="nc">.selected</span> <span class="p">{</span>
  <span class="nl">transform</span><span class="p">:</span> <span class="n">rotate</span><span class="p">(</span><span class="n">var</span><span class="p">(</span><span class="n">--mid-angle</span><span class="p">))</span> <span class="n">translateY</span><span class="p">(</span><span class="m">-6px</span><span class="p">)</span> <span class="n">scale</span><span class="p">(</span><span class="m">1.1</span><span class="p">)</span> <span class="n">rotate</span><span class="p">(</span>
      <span class="n">calc</span><span class="p">(</span><span class="m">-1</span> <span class="err">*</span> <span class="n">var</span><span class="p">(</span><span class="n">--mid-angle</span><span class="p">))</span>
    <span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div><p>This is the final result:</p><video src="videos/pizza-slice-final.mp4" autoplay="" loop="" muted=""></video></div></div><div class="search-overlay"></div></div>
