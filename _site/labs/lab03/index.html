<!DOCTYPE html><html lang="en-US"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=Edge"><link rel="shortcut icon" href="/favicon.ico" type="image/x-icon"><link rel="stylesheet" href="/assets/css/just-the-docs-default.css"> <script src="/assets/js/vendor/lunr.min.js"></script> <script src="/assets/js/just-the-docs.js"></script><meta name="viewport" content="width=device-width, initial-scale=1"><title>Lab 3: Introduction to JS | DSC 106</title><meta name="generator" content="Jekyll v3.9.0" /><meta property="og:title" content="Lab 3: Introduction to JS" /><meta name="author" content="Sam Lau" /><meta property="og:locale" content="en_US" /><meta name="description" content="DSC 106, Winter 2025 at UC San Diego" /><meta property="og:description" content="DSC 106, Winter 2025 at UC San Diego" /><link rel="canonical" href="http://localhost:4000/labs/lab03/" /><meta property="og:url" content="http://localhost:4000/labs/lab03/" /><meta property="og:site_name" content="DSC 106" /><meta property="og:type" content="website" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Lab 3: Introduction to JS" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"WebPage","author":{"@type":"Person","name":"Sam Lau"},"description":"DSC 106, Winter 2025 at UC San Diego","headline":"Lab 3: Introduction to JS","url":"http://localhost:4000/labs/lab03/"}</script><body> <a class="skip-to-main" href="#main-content">Skip to main content</a> <svg xmlns="http://www.w3.org/2000/svg" style="display: none;"> <symbol id="svg-link" viewBox="0 0 24 24"><title>Link</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"><title>Search</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"><title>Menu</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"><title>Expand</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"><polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"><title>Document</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"><path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> <symbol id="svg-external-link" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-external-link"><title id="svg-external-link-title">(external link)</title><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line> </symbol> </svg><div class="side-bar"><div class="site-header"> <a href="/" class="site-title lh-tight"> DSC 106 </a> <a href="#" id="menu-button" class="site-button"> <svg viewBox="0 0 24 24" class="icon"><use xlink:href="#svg-menu"></use></svg> </a></div><nav aria-label="Main" id="site-nav" class="site-nav"><ul class="nav-list"><li class="nav-list-item"><a href="/" class="nav-list-link">🏠 Home</a><li class="nav-list-item"><a href="/syllabus/" class="nav-list-link">📖 Syllabus</a><li class="nav-list-item"><a href="/calendar/" class="nav-list-link">📆 Calendar</a><li class="nav-list-item"><a href="/tech_support/" class="nav-list-link">🙋‍♂️ Tech Support</a><li class="nav-list-item"><a href="/resources/" class="nav-list-link">📚 Resources</a><li class="nav-list-item"><a href="/staff/" class="nav-list-link">👩‍🏫 Staff</a><li class="nav-list-item active"><a href="#" class="nav-list-expander" aria-label="toggle links in 👩‍🔬 Programming Labs category"> <svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg> </a><a href="/labs/" class="nav-list-link">👩‍🔬 Programming Labs</a><ul class="nav-list "><li class="nav-list-item "><a href="/labs/debugging/" class="nav-list-link">Help Us Help You: Things to try before asking for help</a><li class="nav-list-item "><a href="/labs/lab00/" class="nav-list-link">Lab 0: Setup</a><li class="nav-list-item "><a href="/labs/lab01/" class="nav-list-link">Lab 1: Introduction to the Web platform</a><li class="nav-list-item "><a href="/labs/lab02/" class="nav-list-link">Lab 2: Styling with CSS</a><li class="nav-list-item active"><a href="/labs/lab03/" class="nav-list-link active">Lab 3: Introduction to JS</a><li class="nav-list-item "><a href="/labs/lab04/" class="nav-list-link">Lab 4: Svelte (Templating & Control Flow)</a><li class="nav-list-item "><a href="/labs/lab05/" class="nav-list-link">Lab 5: Svelte II (Loading Data & Reactivity)</a><li class="nav-list-item "><a href="/labs/lab06/" class="nav-list-link">Lab 6: Visualizing categorical data with D3</a><li class="nav-list-item "><a href="/labs/lab07/" class="nav-list-link">Lab 7: Visualizing quantitative data with D3</a><li class="nav-list-item "><a href="/labs/lab08/" class="nav-list-link">Lab 8: Geospatial Visualizations</a><li class="nav-list-item "><a href="/labs/lab09/" class="nav-list-link">Lab 9: Animation & Scrollytelling</a></ul><li class="nav-list-item"><a href="#" class="nav-list-expander" aria-label="toggle links in 📝 Projects category"> <svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg> </a><a href="/projects/" class="nav-list-link">📝 Projects</a><ul class="nav-list "><li class="nav-list-item "><a href="/projects/final_project/" class="nav-list-link">Final Project</a><li class="nav-list-item "><a href="/projects/project1/" class="nav-list-link">Project 1: Expository Visualization</a><li class="nav-list-item "><a href="/projects/project2/" class="nav-list-link">Project 2: Deceptive Visualization</a><li class="nav-list-item "><a href="/projects/project2peer/" class="nav-list-link">Project 2: Deceptive Visualization - Peer Grading</a><li class="nav-list-item "><a href="/projects/project3/" class="nav-list-link">Project 3: Interactive Visualization</a><li class="nav-list-item "><a href="/projects/project3peer/" class="nav-list-link">Project 3: Interactive Visualization - Peer Grading</a></ul><li class="nav-list-item"><a href="/labs/lab09/todo/" class="nav-list-link">For next year</a><li class="nav-list-item"><a href="/labs/lab07/old/" class="nav-list-link">Old content, ignore</a><li class="nav-list-item"><a href="/labs/lab09/playtesting/" class="nav-list-link">Playtesting</a><li class="nav-list-item"><a href="/labs/lab05/playtesting/" class="nav-list-link">Playtesting</a><li class="nav-list-item"><a href="/labs/lab06/playtesting/" class="nav-list-link">Playtesting</a><li class="nav-list-item"><a href="/labs/lab07/playtesting/" class="nav-list-link">Playtesting</a><li class="nav-list-item"><a href="/labs/lab08/playtesting/" class="nav-list-link">Playtesting</a><li class="nav-list-item"><a href="/labs/lab02/playtesting/" class="nav-list-link">Playtesting Lab 2</a><li class="nav-list-item"><a href="/labs/lab04/playtesting/enrique/" class="nav-list-link">create-svelte</a><li class="nav-list-item"><a href="/labs/lab04/playtesting/" class="nav-list-link">create-svelte</a></ul></nav><footer class="site-footer"> This site uses <a href="https://github.com/just-the-docs/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll.</footer></div><div class="main" id="top"><div id="main-header" class="main-header"><div class="search"><div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search DSC 106" aria-label="Search DSC 106" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label></div><div id="search-results" class="search-results"></div></div><nav aria-label="Auxiliary" class="aux-nav"><ul class="aux-nav-list"><li class="aux-nav-list-item"> <a href="" class="site-button" > 💻 GitHub </a><li class="aux-nav-list-item"> <a href="" class="site-button" > 🙋 Ed </a><li class="aux-nav-list-item"> <a href="" class="site-button" > 💯 Gradescope </a></ul></nav></div><div id="main-content-wrap" class="main-content-wrap"><nav aria-label="Breadcrumb" class="breadcrumb-nav"><ol class="breadcrumb-nav-list"><li class="breadcrumb-nav-list-item"><a href="/labs/">👩‍🔬 Programming Labs</a><li class="breadcrumb-nav-list-item"><span>Lab 3: Introduction to JS</span></ol></nav><div id="main-content" class="main-content" role="main"><h1 id="lab-3-introduction-to-js"> <a href="#lab-3-introduction-to-js" class="anchor-heading" aria-labelledby="lab-3-introduction-to-js"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Lab 3: Introduction to JS</h1><blockquote class="no_toc summary"><p>In this lab, we will learn:</p><ul><li>What is JS and what is it good for?<li>Basic programming concepts and how they relate to JS<li>JS and JSON data values: primitives (numbers, strings, booleans, <code class="language-plaintext highlighter-rouge">null</code>, <code class="language-plaintext highlighter-rouge">undefined</code>), objects, arrays<li>How to use JS to get references to elements in the DOM and manipulate them on the fly<li>How to use JS to create new elements on the fly and add them to the DOM<li>How to run JS code as a response to user actions (Events)</ul></blockquote><details open=""> <summary class="text-delta"> Table of contents </summary><ul id="markdown-toc"><li><a href="#lab-3-introduction-to-js" id="markdown-toc-lab-3-introduction-to-js">Lab 3: Introduction to JS</a><ul><li><a href="#check-off" id="markdown-toc-check-off">Check-off</a><li><a href="#prerequisites" id="markdown-toc-prerequisites">Prerequisites</a><li><a href="#questions-doc" id="markdown-toc-questions-doc"><a href="https://docs.google.com/document/d/1qOWlje-XdzYl7kX16LlTJoP0jC2lPRddLIY9Pm5uWO4/edit?usp=sharing" target="_blank" rel="noopener noreferrer">Questions Doc</a></a><li><a href="#slides" id="markdown-toc-slides">Slides</a><li><a href="#step-1-adding-a-js-file-to-all-pages-in-class" id="markdown-toc-step-1-adding-a-js-file-to-all-pages-in-class">Step 1: Adding a JS file to all pages <em>(In class)</em></a><li><a href="#step-2-automatic-current-page-link" id="markdown-toc-step-2-automatic-current-page-link">Step 2: Automatic current page link</a><ul><li><a href="#step-21-get-an-array-of-all-nav-links-into-a-variable" id="markdown-toc-step-21-get-an-array-of-all-nav-links-into-a-variable">Step 2.1: Get an array of all nav links into a variable</a><li><a href="#step-22-find-the-link-to-the-current-page" id="markdown-toc-step-22-find-the-link-to-the-current-page">Step 2.2: Find the link to the current page</a><li><a href="#step-23-add-the-current-class-to-the-current-page-link" id="markdown-toc-step-23-add-the-current-class-to-the-current-page-link">Step 2.3: Add the <code class="language-plaintext highlighter-rouge">current</code> class to the current page link</a></ul><li><a href="#step-3-automatic-navigation-menu" id="markdown-toc-step-3-automatic-navigation-menu">Step 3: Automatic navigation menu</a><ul><li><a href="#step-31-adding-the-navigation-menu" id="markdown-toc-step-31-adding-the-navigation-menu">Step 3.1: Adding the navigation menu</a><li><a href="#step-32-highlighting-the-current-page-and-opening-external-links-in-a-new-tab" id="markdown-toc-step-32-highlighting-the-current-page-and-opening-external-links-in-a-new-tab">Step 3.2: Highlighting the current page and opening external links in a new tab</a></ul><li><a href="#step-4-dark-mode" id="markdown-toc-step-4-dark-mode">Step 4: Dark mode!</a><ul><li><a href="#step-41-automatic-dark-mode" id="markdown-toc-step-41-automatic-dark-mode">Step 4.1 Automatic dark mode.</a><ul><li><a href="#adjusting-the-border-color" id="markdown-toc-adjusting-the-border-color">Adjusting the border color</a><li><a href="#fixing-the-hover-background-color-optional" id="markdown-toc-fixing-the-hover-background-color-optional">Fixing the hover background color <em>(optional)</em></a></ul><li><a href="#step-42-adding-html-for-the-dark-mode-switch" id="markdown-toc-step-42-adding-html-for-the-dark-mode-switch">Step 4.2: Adding HTML for the dark mode switch</a><li><a href="#step-43-placing-the-switcher-at-the-top-right-corner" id="markdown-toc-step-43-placing-the-switcher-at-the-top-right-corner">Step 4.3: Placing the switcher at the top right corner</a><li><a href="#step-44-actually-making-it-work" id="markdown-toc-step-44-actually-making-it-work">Step 4.4: Actually making it work</a><li><a href="#step-45-saving-the-users-preference" id="markdown-toc-step-45-saving-the-users-preference">Step 4.5: Saving the user’s preference</a></ul><li><a href="#step-5-better-contact-form-optional" id="markdown-toc-step-5-better-contact-form-optional">Step 5: Better contact form <em>(Optional)</em></a><li><a href="#js-resources" id="markdown-toc-js-resources">JS resources</a><ul><li><a href="#videos" id="markdown-toc-videos">Videos</a><li><a href="#books" id="markdown-toc-books">Books</a></ul></ul></ul></details><hr /><h2 id="check-off"> <a href="#check-off" class="anchor-heading" aria-labelledby="check-off"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Check-off</h2><p><strong>You need to come to TA Office Hours to get checked off for this lab</strong> (any of them, no appointment needed). Please fill in <a href="checkoff">the check-off form at <code class="language-plaintext highlighter-rouge">labs/3/checkoff</code></a> <em>before</em> your check-off (right before is fine — even preferred).</p><p class="warning">Filling out the form is a necessary but not sufficient condition to get checked-off. <strong>You still need to come to office hours in person for your check-off to be processed.</strong></p><h2 id="prerequisites"> <a href="#prerequisites" class="anchor-heading" aria-labelledby="prerequisites"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Prerequisites</h2><p>This lab assumes you have already completed <a href="../1/">Lab 1</a> and <a href="../2/">Lab 2</a>, as we will use the same website as a starting point.</p><p class="warning">You will need to use a local server for this lab, as some features will not work under the <code class="language-plaintext highlighter-rouge">file:</code> protocol (i.e. when opening the files directly in the browser). If you are using Live Preview, we recommend you switch to <a href="../0/#installing-a-local-server">Live Server</a> as Live Preview seems to have issues with newer CSS features.</p><h2 id="questions-doc"> <a href="#questions-doc" class="anchor-heading" aria-labelledby="questions-doc"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <a href="https://docs.google.com/document/d/1qOWlje-XdzYl7kX16LlTJoP0jC2lPRddLIY9Pm5uWO4/edit?usp=sharing" target="_blank" rel="noopener noreferrer">Questions Doc</a></h2><p>Add questions to the questions doc throughout the lecture and lab! After lab, come to <a href="../../logistics/staff.html#office-hours">office hours</a> or ask on <a href="https://vis-society-forum.csail.mit.edu/">Discourse</a> for futher questions!</p><h2 id="slides"> <a href="#slides" class="anchor-heading" aria-labelledby="slides"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <a href="./slides/">Slides</a></h2><p>Make sure to read the notes on each slide as well!</p><p>Specific slides that may be useful while working on this lab:</p><ul><li><a href="./slides/#operators">Operator cheatsheet</a><li><a href="./slides/#elements">Element reference cheatsheet</a><li><a href="./slides/#dom-manipulation">Element manipulation cheatsheet</a></ul><h2 id="step-1-adding-a-js-file-to-all-pages-in-class"> <a href="#step-1-adding-a-js-file-to-all-pages-in-class" class="anchor-heading" aria-labelledby="step-1-adding-a-js-file-to-all-pages-in-class"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Step 1: Adding a JS file to all pages <em>(In class)</em></h2><p>For this lab, we will add a new file to our website: <code class="language-plaintext highlighter-rouge">global.js</code>. It will go in your website root, next to <code class="language-plaintext highlighter-rouge">index.html</code> and <code class="language-plaintext highlighter-rouge">style.css</code>, and should be linked from all pages (make sure to use <code class="language-plaintext highlighter-rouge">type="module"</code>).</p><p>Put the following code in <code class="language-plaintext highlighter-rouge">global.js</code>:</p><div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">IT’S ALIVE!</span><span class="dl">'</span><span class="p">);</span>

<span class="kd">function</span> <span class="nx">$$</span><span class="p">(</span><span class="nx">selector</span><span class="p">,</span> <span class="nx">context</span> <span class="o">=</span> <span class="nb">document</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nb">Array</span><span class="p">.</span><span class="k">from</span><span class="p">(</span><span class="nx">context</span><span class="p">.</span><span class="nx">querySelectorAll</span><span class="p">(</span><span class="nx">selector</span><span class="p">));</span>
<span class="p">}</span>
</code></pre></div></div><p>Visit all your pages, open the dev tools console, and make sure you see the message printed there.</p><p><img src="images/its-alive.png" alt="" class="browser" /></p><h2 id="step-2-automatic-current-page-link"> <a href="#step-2-automatic-current-page-link" class="anchor-heading" aria-labelledby="step-2-automatic-current-page-link"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Step 2: Automatic current page link</h2><p>Remember how in <a href="../2/">Lab 2</a> we added a class to the current page link? Wasn’t it tedious to do that manually? We will now use JS to automate this!</p><p>First, remove the manual <code class="language-plaintext highlighter-rouge">current</code> class from all your links.</p><h3 id="step-21-get-an-array-of-all-nav-links-into-a-variable"> <a href="#step-21-get-an-array-of-all-nav-links-into-a-variable" class="anchor-heading" aria-labelledby="step-21-get-an-array-of-all-nav-links-into-a-variable"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Step 2.1: Get an array of all nav links into a variable</h3><p>We will use the <code class="language-plaintext highlighter-rouge">$$</code> function we defined earlier to get an array of all our nav links. Remember that the CSS selector <code class="language-plaintext highlighter-rouge">nav a</code> will get all <code class="language-plaintext highlighter-rouge">&lt;a&gt;</code> elements inside a <code class="language-plaintext highlighter-rouge">&lt;nav&gt;</code> element, which is what we want.</p><p>Putting it together, <code class="language-plaintext highlighter-rouge">$$("nav a")</code> will get us an array of all our nav links, which we can assign to a variable, e.g. <code class="language-plaintext highlighter-rouge">navLinks</code></p><h3 id="step-22-find-the-link-to-the-current-page"> <a href="#step-22-find-the-link-to-the-current-page" class="anchor-heading" aria-labelledby="step-22-find-the-link-to-the-current-page"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Step 2.2: Find the link to the current page</h3><p>To find the link to the current page, we need three pieces of information:</p><ul><li>The <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/find"><code class="language-plaintext highlighter-rouge">array.find()</code></a> method gives us the first array element that passes a test. For example, <code class="language-plaintext highlighter-rouge">[1, 2, 3, 4].find(n =&gt; n &gt; 2)</code> will return <code class="language-plaintext highlighter-rouge">3</code> (try it in the console!).<li>The <a href="https://developer.mozilla.org/en-US/docs/Web/API/Location"><code class="language-plaintext highlighter-rouge">location</code></a> object, which has information about the current page, such as <code class="language-plaintext highlighter-rouge">location.host</code> and <code class="language-plaintext highlighter-rouge">location.pathname</code>.<li>When we get references to <code class="language-plaintext highlighter-rouge">&lt;a&gt;</code> elements, they also include these URL properties (<code class="language-plaintext highlighter-rouge">host</code>, <code class="language-plaintext highlighter-rouge">pathname</code>, etc.). Even if the link is relative, the values of these properties will be after it has been resolved to an absolute URL, using the URL of the current page as a base. The browser needs to resolve it to an absolute URL anyway to make it work, so exposing these properties is a convenience for us.</ul><p>A link to the current page will have the same <code class="language-plaintext highlighter-rouge">host</code> and <code class="language-plaintext highlighter-rouge">pathname</code> as the current page.</p><p>Putting it together, we can get the link to the current page via:</p><div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">let</span> <span class="nx">currentLink</span> <span class="o">=</span> <span class="nx">navLinks</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span>
  <span class="p">(</span><span class="nx">a</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">a</span><span class="p">.</span><span class="nx">host</span> <span class="o">===</span> <span class="nx">location</span><span class="p">.</span><span class="nx">host</span> <span class="o">&amp;&amp;</span> <span class="nx">a</span><span class="p">.</span><span class="nx">pathname</span> <span class="o">===</span> <span class="nx">location</span><span class="p">.</span><span class="nx">pathname</span><span class="p">,</span>
<span class="p">);</span>
</code></pre></div></div><h3 id="step-23-add-the-current-class-to-the-current-page-link"> <a href="#step-23-add-the-current-class-to-the-current-page-link" class="anchor-heading" aria-labelledby="step-23-add-the-current-class-to-the-current-page-link"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Step 2.3: Add the <code class="language-plaintext highlighter-rouge">current</code> class to the current page link</h3><p>Now that we have a reference ot the current page link, we can add the <code class="language-plaintext highlighter-rouge">current</code> class to it using <a href="https://developer.mozilla.org/en-US/docs/Web/API/Element/classList"><code class="language-plaintext highlighter-rouge">element.classList.add(class1, class2, ...)</code></a>:</p><div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">currentLink</span><span class="p">.</span><span class="nx">classList</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="dl">'</span><span class="s1">current</span><span class="dl">'</span><span class="p">);</span>
</code></pre></div></div><p>But what if no link to the current page was found? In that case, <code class="language-plaintext highlighter-rouge">navLinks.find()</code> will return <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/undefined"><code class="language-plaintext highlighter-rouge">undefined</code></a> and trying to access any property on <code class="language-plaintext highlighter-rouge">currentLink</code> will throw an error.</p><p>There are two ways to fix this problem:</p><p>The first way is to use a <strong>conditional</strong> to only add the class if <code class="language-plaintext highlighter-rouge">currentLink</code> is <a href="https://developer.mozilla.org/en-US/docs/Glossary/Truthy">truthy</a>:</p><div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">if</span> <span class="p">(</span><span class="nx">currentLink</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// or if (currentLink !== undefined)</span>
  <span class="nx">currentLink</span><span class="p">.</span><span class="nx">classList</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="dl">'</span><span class="s1">current</span><span class="dl">'</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div><p>This is more flexible, as we can run any amount of code inside the <code class="language-plaintext highlighter-rouge">if</code> block, and we could even add an <code class="language-plaintext highlighter-rouge">else</code> block to run code when no link is found, if needed.</p><p>However, if all we need is to prevent errors, we can use the <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Optional_chaining">optional chaining operator</a>, i.e. <code class="language-plaintext highlighter-rouge">?.</code> instead of <code class="language-plaintext highlighter-rouge">.</code>:</p><div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">currentLink</span><span class="p">?.</span><span class="nx">classList</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="dl">'</span><span class="s1">current</span><span class="dl">'</span><span class="p">);</span>
</code></pre></div></div><h2 id="step-3-automatic-navigation-menu"> <a href="#step-3-automatic-navigation-menu" class="anchor-heading" aria-labelledby="step-3-automatic-navigation-menu"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Step 3: Automatic navigation menu</h2><p>But why stop here? Wasn’t it tedious to need to copy-pasta the navigation to all pages? And imagine the horror of adding a new page to our site: we’d have to update every single page!</p><p>We can automate this too!</p><p class="warning">Client-side JS is not the best way to handle site-wide templating, but it’s good as a temporary fix, and as a learning exercise.</p><p>First, remove the navigation menu from all pages, since we’re going to be adding it with JS. Also remove your code from Step 2 (or comment it out by selecting it and pressing Cmd/Ctrl + /), since we’ll now be adding the <code class="language-plaintext highlighter-rouge">current</code> class at the same time as we add the links.</p><h3 id="step-31-adding-the-navigation-menu"> <a href="#step-31-adding-the-navigation-menu" class="anchor-heading" aria-labelledby="step-31-adding-the-navigation-menu"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Step 3.1: Adding the navigation menu</h3><p>As we saw in the slides, there are many ways to design a data structure to hold the association of URLs (relative or absolute) and page titles. Let’s go with an <a href="#arrays">array</a> of <a href="slides/#objects">objects</a> for now, but if you want to use a different one (and handle the code differences) you’re welcome to!</p><div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">let</span> <span class="nx">pages</span> <span class="o">=</span> <span class="p">[</span>
  <span class="p">{</span> <span class="na">url</span><span class="p">:</span> <span class="dl">''</span><span class="p">,</span> <span class="na">title</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Home</span><span class="dl">'</span> <span class="p">},</span>
  <span class="p">{</span> <span class="na">url</span><span class="p">:</span> <span class="dl">'</span><span class="s1">projects/</span><span class="dl">'</span><span class="p">,</span> <span class="na">title</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Projects</span><span class="dl">'</span> <span class="p">},</span>
  <span class="c1">// add the rest of your pages here</span>
<span class="p">];</span>
</code></pre></div></div><p>Then, create a new <code class="language-plaintext highlighter-rouge">&lt;nav&gt;</code> element (via <a href="https://developer.mozilla.org/en-US/docs/Web/API/Document/createElement"><code class="language-plaintext highlighter-rouge">document.createElement()</code></a>) and add it inside <code class="language-plaintext highlighter-rouge">&lt;body&gt;</code> at the beginning (via <a href="https://developer.mozilla.org/en-US/docs/Web/API/Element/prepend"><code class="language-plaintext highlighter-rouge">element.prepend()</code></a>).:</p><div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">let</span> <span class="nx">nav</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="dl">'</span><span class="s1">nav</span><span class="dl">'</span><span class="p">);</span>
<span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">prepend</span><span class="p">(</span><span class="nx">nav</span><span class="p">);</span>
</code></pre></div></div><p>Then we will use a <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/for...of"><code class="language-plaintext highlighter-rouge">for .. of</code></a> loop to iterate over the pages on our site and add <code class="language-plaintext highlighter-rouge">&lt;a&gt;</code> elements in the <code class="language-plaintext highlighter-rouge">&lt;nav&gt;</code> for each of them. It will look like this:</p><div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">p</span> <span class="k">of</span> <span class="nx">pages</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">let</span> <span class="nx">url</span> <span class="o">=</span> <span class="nx">p</span><span class="p">.</span><span class="nx">url</span><span class="p">;</span>
  <span class="kd">let</span> <span class="nx">title</span> <span class="o">=</span> <span class="nx">p</span><span class="p">.</span><span class="nx">title</span><span class="p">;</span>
  <span class="c1">// TODO create link and add it to nav</span>
<span class="p">}</span>
</code></pre></div></div><p>Then, to create each link and add it to the nav, you can use <a href="https://developer.mozilla.org/en-US/docs/Web/API/Element/insertAdjacentHTML"><code class="language-plaintext highlighter-rouge">element.insertAdjacentHTML()</code></a>:</p><div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Create link and add it to nav</span>
<span class="nx">nav</span><span class="p">.</span><span class="nx">insertAdjacentHTML</span><span class="p">(</span><span class="dl">'</span><span class="s1">beforeend</span><span class="dl">'</span><span class="p">,</span> <span class="s2">`&lt;a href="</span><span class="p">${</span><span class="nx">url</span><span class="p">}</span><span class="s2">"&gt;</span><span class="p">${</span><span class="nx">title</span><span class="p">}</span><span class="s2">&lt;/a&gt;`</span><span class="p">);</span>
</code></pre></div></div><p>Save and preview: you should now have a navigation menu on every page that is added automatically!</p><p>However, there is a bit of a wart. Try your menu on different pages. Oh noes, the links only work properly on the home page! That is because we had previously used different relative URls for different pages, but now we are trying to use the same one across the entire website.</p><p>Let’s try to do with JS what we previously did manually (sensing a theme here?). What we previously did was that for any page that was not the home page, we added <code class="language-plaintext highlighter-rouge">../</code> to the URL, right? So what if we could detect if we’re not on the home page and add that <code class="language-plaintext highlighter-rouge">../</code> to the URL conditionally?</p><p>But how could we possibly detect if we’re on the home page in a way that works both locally and on our <code class="language-plaintext highlighter-rouge">github.io</code> site? Sadly, there is no way (that will not bite us in the future) to tell entirely by looking at the URL. We can however help the JS along by adding a class of <code class="language-plaintext highlighter-rouge">home</code> to the root element of our home page, and then using JS to check if that class is present and storing it in a variable (well, actually a constant, since that is not likely to change):</p><div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">ARE_WE_HOME</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">documentElement</span><span class="p">.</span><span class="nx">classList</span><span class="p">.</span><span class="nx">contains</span><span class="p">(</span><span class="dl">'</span><span class="s1">home</span><span class="dl">'</span><span class="p">);</span>
</code></pre></div></div><p class="tip">The <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/const"><code class="language-plaintext highlighter-rouge">const</code></a> keyword is similar to <code class="language-plaintext highlighter-rouge">let</code>, but it makes the variable immutable, i.e. it cannot be reassigned. Variables that should never change are called constants, and their names are UPPERCASE by convention.</p><p>Then, when creating the links, use a conditional to add a <code class="language-plaintext highlighter-rouge">../</code> to the URL if we’re not on the home page and the URL is not absolute. We can use an <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/if...else">if statement</a> for that:</p><div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">ARE_WE_HOME</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">url</span><span class="p">.</span><span class="nx">startsWith</span><span class="p">(</span><span class="dl">'</span><span class="s1">http</span><span class="dl">'</span><span class="p">))</span> <span class="p">{</span>
  <span class="nx">url</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">../</span><span class="dl">'</span> <span class="o">+</span> <span class="nx">url</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div><p>Alternatively, we can do it more concisely with a <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Conditional_operator">ternary operator</a>:</p><div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">url</span> <span class="o">=</span> <span class="o">!</span><span class="nx">ARE_WE_HOME</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">url</span><span class="p">.</span><span class="nx">startsWith</span><span class="p">(</span><span class="dl">'</span><span class="s1">http</span><span class="dl">'</span><span class="p">)</span> <span class="p">?</span> <span class="dl">'</span><span class="s1">../</span><span class="dl">'</span> <span class="o">+</span> <span class="nx">url</span> <span class="p">:</span> <span class="nx">url</span><span class="p">;</span>
</code></pre></div></div><h3 id="step-32-highlighting-the-current-page-and-opening-external-links-in-a-new-tab"> <a href="#step-32-highlighting-the-current-page-and-opening-external-links-in-a-new-tab" class="anchor-heading" aria-labelledby="step-32-highlighting-the-current-page-and-opening-external-links-in-a-new-tab"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Step 3.2: Highlighting the current page and opening external links in a new tab</h3><p>Our automatically added navigation menu works, but is missing all the bells and whistles of our original one:</p><ul><li>The current page is not highlighted anymore<li>The link to your GitHub profile does not have <code class="language-plaintext highlighter-rouge">target="_blank"</code> to make it open in a new tab.</ul><p>How can we add those back?</p><p>Let’s switch to a different method of creating these links, that is more verbose, but gives us more flexibility. Instead of appending HTML strings, we will create element objects in JS and set their attributes in JS, via properties (or <a href="https://developer.mozilla.org/en-US/docs/Web/API/Element/setAttribute"><code class="language-plaintext highlighter-rouge">setAttribute()</code></a> calls.</p><p>So, this line of JS:</p><div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">nav</span><span class="p">.</span><span class="nx">insertAdjacentHTML</span><span class="p">(</span><span class="dl">'</span><span class="s1">beforeend</span><span class="dl">'</span><span class="p">,</span> <span class="s2">`&lt;a href="</span><span class="p">${</span><span class="nx">url</span><span class="p">}</span><span class="s2">"&gt;</span><span class="p">${</span><span class="nx">title</span><span class="p">}</span><span class="s2">&lt;/a&gt;`</span><span class="p">);</span>
</code></pre></div></div><p>now becomes four lines:</p><div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">let</span> <span class="nx">a</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="dl">'</span><span class="s1">a</span><span class="dl">'</span><span class="p">);</span>
<span class="nx">a</span><span class="p">.</span><span class="nx">href</span> <span class="o">=</span> <span class="nx">url</span><span class="p">;</span>
<span class="nx">a</span><span class="p">.</span><span class="nx">textContent</span> <span class="o">=</span> <span class="nx">title</span><span class="p">;</span>
<span class="nx">nav</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="nx">a</span><span class="p">);</span>
</code></pre></div></div><p>Save and preview, and make sure nothing changed and that there are no errors.</p><p>We can now use a conditional to add the <code class="language-plaintext highlighter-rouge">current</code> class, in a similar way to how we added it in step 2. We don’t need <code class="language-plaintext highlighter-rouge">array.find()</code> this time, because we are already iterating over the links to create them. We can just add a conditional to check if the link is to the current page using exactly the same check as <a href="#step-22-find-the-link-to-the-current-page">Step 2.2</a> and add the class if so.</p><p>All we need is to compare <code class="language-plaintext highlighter-rouge">a.host</code> and <code class="language-plaintext highlighter-rouge">a.pathname</code> to <code class="language-plaintext highlighter-rouge">location.host</code> and <code class="language-plaintext highlighter-rouge">location.pathname</code> and then use <a href="https://developer.mozilla.org/en-US/docs/Web/API/Element/classList"><code class="language-plaintext highlighter-rouge">a.classList.add()</code></a> to add the class.</p><div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">if</span> <span class="p">(</span><span class="nx">a</span><span class="p">.</span><span class="nx">host</span> <span class="o">===</span> <span class="nx">location</span><span class="p">.</span><span class="nx">host</span> <span class="o">&amp;&amp;</span> <span class="nx">a</span><span class="p">.</span><span class="nx">pathname</span> <span class="o">===</span> <span class="nx">location</span><span class="p">.</span><span class="nx">pathname</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">a</span><span class="p">.</span><span class="nx">classList</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="dl">'</span><span class="s1">current</span><span class="dl">'</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div><p class="tip">You can even use <code class="language-plaintext highlighter-rouge">a.className.toggle()</code> to do the checking and the class adding in one (very long) line!</p><div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">a</span><span class="p">.</span><span class="nx">classList</span><span class="p">.</span><span class="nx">toggle</span><span class="p">(</span>
  <span class="dl">'</span><span class="s1">current</span><span class="dl">'</span><span class="p">,</span>
  <span class="nx">a</span><span class="p">.</span><span class="nx">host</span> <span class="o">===</span> <span class="nx">location</span><span class="p">.</span><span class="nx">host</span> <span class="o">&amp;&amp;</span> <span class="nx">a</span><span class="p">.</span><span class="nx">pathname</span> <span class="o">===</span> <span class="nx">location</span><span class="p">.</span><span class="nx">pathname</span><span class="p">,</span>
<span class="p">);</span>
</code></pre></div></div><p>Similarly, we can add <code class="language-plaintext highlighter-rouge">target="_blank"</code> to external links (such as the GitHub link) by setting <code class="language-plaintext highlighter-rouge">a.target = "_blank"</code> to those links for which <code class="language-plaintext highlighter-rouge">a.host</code> is not the same as <code class="language-plaintext highlighter-rouge">location.host</code>.</p><p class="tip">Just like class names, you can either use conditionals or do the checking and the attribute setting in one step, by using <a href="https://developer.mozilla.org/en-US/docs/Web/API/Element/toggleAttribute"><code class="language-plaintext highlighter-rouge">element.toggleAttribute()</code></a>.</p><h2 id="step-4-dark-mode"> <a href="#step-4-dark-mode" class="anchor-heading" aria-labelledby="step-4-dark-mode"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Step 4: Dark mode!</h2><p>Let’s add a dark mode switch to our site!</p><h3 id="step-41-automatic-dark-mode"> <a href="#step-41-automatic-dark-mode" class="anchor-heading" aria-labelledby="step-41-automatic-dark-mode"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Step 4.1 Automatic dark mode.</h3><p>In this step we will write CSS that will automatically adapt to the OS color scheme and tweak our style so that everything looks good on dark mode.</p><p>CSS provides a <a href="https://developer.mozilla.org/en-US/docs/Web/CSS/color-scheme"><code class="language-plaintext highlighter-rouge">color-scheme</code></a> property that can be used to switch between light and dark mode.</p><ul><li><code class="language-plaintext highlighter-rouge">color-scheme: light dark</code> tells the browser that the site can be rendered on either light or dark mode, depending on what the OS color scheme is.<li><code class="language-plaintext highlighter-rouge">color-scheme: light</code> or <code class="language-plaintext highlighter-rouge">color-scheme: dark</code> forces a specific color scheme.</ul><p>When <code class="language-plaintext highlighter-rouge">color-scheme</code> is <code class="language-plaintext highlighter-rouge">dark</code> (or <code class="language-plaintext highlighter-rouge">light dark</code> and the OS is in dark mode), you will notice several changes: The default background color will be a very dark gray instead of white, and the default text color will be white instead of black. We can actually access these special colors and use them in our CSS by using the <code class="language-plaintext highlighter-rouge">canvas</code> and <code class="language-plaintext highlighter-rouge">canvastext</code> <em>system colors</em>.</p><p>When applied to the root element (<code class="language-plaintext highlighter-rouge">&lt;html&gt;</code>) this property will already get your site very close to a proper dark mode. Try it now! Add it to your stylesheet so that it’s applied on every page.</p><p><img src="images/color-scheme-dark.png" alt="" class="browser" /></p><h4 id="adjusting-the-border-color"> <a href="#adjusting-the-border-color" class="anchor-heading" aria-labelledby="adjusting-the-border-color"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Adjusting the border color</h4><script type="module" src="https://colorjs.io/elements/color-swatch/color-swatch.js"></script><p>While it doesn’t look too bad, in light mode we picked a border color that looked very subtle (<color-swatch><code>oklch(80% 3% 200)</code></color-swatch>) but in contrast to the almost-black background, it looks very harsh.</p><p>This is because its lightness is fixed to 80%, which means it does not adapt to the color scheme. One way to fix that would be to make it a semi-transparent version of a darker, slightly more vibrant color (e.g.<color-swatch><code>oklch(50% 10% 200)</code></color-swatch>) with 40% opacity:</p><div class="language-css highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">border-bottom-color</span><span class="o">:</span> <span class="nt">oklch</span><span class="o">(</span><span class="err">50</span><span class="o">%</span> <span class="err">10</span><span class="o">%</span> <span class="err">200</span> <span class="o">/</span> <span class="err">40</span><span class="o">%);</span>
</code></pre></div></div><p>Since we’re using it in two places, you may want to define a CSS variable for it on <code class="language-plaintext highlighter-rouge">&lt;nav&gt;</code>:</p><div class="language-css highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">nav</span> <span class="p">{</span>
  <span class="py">--border-color</span><span class="p">:</span> <span class="n">oklch</span><span class="p">(</span><span class="m">50%</span> <span class="m">10%</span> <span class="m">200</span> <span class="p">/</span> <span class="m">40%</span><span class="p">);</span>
  <span class="c">/* ... other styles and nested rules ... */</span>
<span class="p">}</span>
</code></pre></div></div><p>and then use that instead:</p><div class="language-css highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">border-bottom-color</span><span class="o">:</span> <span class="nt">var</span><span class="o">(</span><span class="nt">--border-color</span><span class="o">);</span>
</code></pre></div></div><p>That should look about the same in light mode, and much better in dark mode.</p><figure><p><img src="/labs/lab03/images/menu-border-before-after.gif" alt="" /></p><figcaption> The menu border color before and after the change (animated gif).</figcaption></figure><h4 id="fixing-the-hover-background-color-optional"> <a href="#fixing-the-hover-background-color-optional" class="anchor-heading" aria-labelledby="fixing-the-hover-background-color-optional"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Fixing the hover background color <em>(optional)</em></h4><p>If you did the optional hover background color in Lab 2, you may have noticed that it looks very bad in dark mode now.</p><p><img src="/labs/lab03/images/nav-highlight-dark-broken.png" alt="" /></p><p>That is because we defined that color with a fixed lightness (95%):</p><div class="language-css highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">background-color</span><span class="o">:</span> <span class="nt">oklch</span><span class="o">(</span><span class="nt">from</span> <span class="nt">var</span><span class="o">(</span><span class="nt">--color-accent</span><span class="o">)</span> <span class="err">95</span><span class="o">%</span> <span class="err">5</span><span class="o">%</span> <span class="nt">h</span><span class="o">);</span>
</code></pre></div></div><p>Just like our border color, it was very subtle in light mode, but sticks out like a sore thumb in dark mode. Worse, since the text color has changed, it is now illegible. Yikes!</p><p>We <em>could</em> fix that too by setting its lightness to 50% and increasing its chroma, then adding transparency. But here is another method.</p><p>We can make it a mix of the background color and the special <code class="language-plaintext highlighter-rouge">canvas</code> color:</p><div class="language-css highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">background-color</span><span class="o">:</span> <span class="nt">color-mix</span><span class="o">(</span><span class="nt">in</span> <span class="nt">oklch</span><span class="o">,</span> <span class="nt">var</span><span class="o">(</span><span class="nt">--color-accent</span><span class="o">),</span> <span class="nt">canvas</span> <span class="err">85</span><span class="o">%);</span>
</code></pre></div></div><p>This should now look a lot better:</p><p><img src="/labs/lab03/images/nav-highlight-dark.png" alt="" />.</p><h3 id="step-42-adding-html-for-the-dark-mode-switch"> <a href="#step-42-adding-html-for-the-dark-mode-switch" class="anchor-heading" aria-labelledby="step-42-adding-html-for-the-dark-mode-switch"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Step 4.2: Adding HTML for the dark mode switch</h3><p>We want our switch to have three states: Automatic (the default, adapts to the OS color scheme), Light, and Dark. The heavy lifting is already done in the CSS, so all the switch needs to do is set the <code class="language-plaintext highlighter-rouge">color-scheme</code> property appropriately on the root element.</p><p>First we need to add the form controls for selecting the color scheme. A good option is a <code class="language-plaintext highlighter-rouge">&lt;select&gt;</code> element (plus <code class="language-plaintext highlighter-rouge">&lt;option&gt;</code> elements inside it), which creates a dropdown menu.</p><video src="videos/switcher.mp4" style="object-fit: none;object-position: calc(100% - -50px) -50px;height: 180px;width: 100%;" loop="" autoplay="" muted=""></video><p>Make sure to use a <code class="language-plaintext highlighter-rouge">&lt;label&gt;</code> around it. You can give the <code class="language-plaintext highlighter-rouge">&lt;label&gt;</code> a class (I used <code class="language-plaintext highlighter-rouge">color-scheme</code>) so you can style it in your CSS.</p><details class="tip"> <summary>Why not radio buttons?</summary><p><a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/input/radio">Radio buttons</a> (in a <code class="language-plaintext highlighter-rouge">&lt;fieldset&gt;</code> element) would have also been perfectly acceptable, but are more work to handle with JS, so we went with a dropdown to simplify the code. Also, from a usability perspective, while radio buttons can provide better efficiency for short lists of options, they also occupy a lot more screen real estate, which is not really warranted for something used as infrequently as a theme switcher.</p></details><p class="note">While <a href="https://vis-society-forum.csail.mit.edu/t/wrap-input-in-form/251/3?u=leaverou">I think</a> nesting form controls inside the <code class="language-plaintext highlighter-rouge">&lt;label&gt;</code> produces cleaner code, feel free to use the <code class="language-plaintext highlighter-rouge">for</code> attribute with an id if you prefer. In that case, you’d need to wrap both of them with a <code class="language-plaintext highlighter-rouge">&lt;div&gt;</code> and give <em>that</em> the <code class="language-plaintext highlighter-rouge">color-scheme</code> class.</p><p>Since this control doesn’t do anything without JS, you should create it with JS as well, similarly to what we did with the <code class="language-plaintext highlighter-rouge">&lt;nav&gt;</code> menu in step 3. That way, you also don’t have to add it manually on every single page. You can use something like this to add it to the start of the <code class="language-plaintext highlighter-rouge">&lt;body&gt;</code> element:</p><div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">insertAdjacentHTML</span><span class="p">(</span>
  <span class="dl">'</span><span class="s1">afterbegin</span><span class="dl">'</span><span class="p">,</span>
  <span class="s2">`
	&lt;label class="color-scheme"&gt;
		Theme:
		&lt;select&gt;
			&lt;!-- TODO add &lt;option&gt; elements here --&gt;
		&lt;/select&gt;
	&lt;/label&gt;`</span><span class="p">,</span>
<span class="p">);</span>
</code></pre></div></div><p>For the <code class="language-plaintext highlighter-rouge">value</code> attribute of your <code class="language-plaintext highlighter-rouge">&lt;option&gt;</code> elements, use the actual values each option should set the <code class="language-plaintext highlighter-rouge">color-scheme</code> property to (<code class="language-plaintext highlighter-rouge">light dark</code>, <code class="language-plaintext highlighter-rouge">light</code>, <code class="language-plaintext highlighter-rouge">dark</code>), so that you don’t need to do any conversion in JS.</p><p class="tip">You might wonder if it’s possible to detect the OS color scheme and somehow use that in the dropdown (e.g. instead of showing “Automatic” we could show “Automatic (Dark)”). It is! You can do this via <code class="language-plaintext highlighter-rouge">matchMedia("(prefers-color-scheme: dark)").matches</code>. In fact, this is a <a href="https://developer.mozilla.org/en-US/docs/Web/CSS/CSS_media_queries/Using_media_queries">media query</a> and specifically the <a href="https://developer.mozilla.org/en-US/docs/Web/CSS/@media/prefers-color-scheme"><code class="language-plaintext highlighter-rouge">prefers-color-scheme</code> media feature</a>. You can use media queries in your CSS too!</p><h3 id="step-43-placing-the-switcher-at-the-top-right-corner"> <a href="#step-43-placing-the-switcher-at-the-top-right-corner" class="anchor-heading" aria-labelledby="step-43-placing-the-switcher-at-the-top-right-corner"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Step 4.3: Placing the switcher at the top right corner</h3><p>Rather than laying out with the rest of the content, we want the switcher to always be at the top right corner. We will do that via CSS <a href="https://developer.mozilla.org/en-US/docs/Learn/CSS/CSS_layout/Positioning">absolute positioning</a>.</p><ol><li>First, we apply <code class="language-plaintext highlighter-rouge">position: absolute</code> to our switcher (the <code class="language-plaintext highlighter-rouge">&lt;label&gt;</code> element with the <code class="language-plaintext highlighter-rouge">color-scheme</code> class) Notice that this took the element out of the normal document flow, and it’s now on top of the content.<li>We specify offsets from the top and right edges of the document with <code class="language-plaintext highlighter-rouge">top</code> and <code class="language-plaintext highlighter-rouge">right</code> properties. I used <code class="language-plaintext highlighter-rouge">1rem</code> for both but you may want to use a different value (experiment with the dev tools and see what looks good to you).</ol><p>You’d probably also want to make the font a little smaller (I used <code class="language-plaintext highlighter-rouge">80%</code>) to make it less prominent and inherit the <code class="language-plaintext highlighter-rouge">font-family</code> from the parent, otherwise the browser applies a different font to form controls (you can just add <code class="language-plaintext highlighter-rouge">select</code> to your existing <code class="language-plaintext highlighter-rouge">input, textarea, button</code> rule about that from <a href="../2/#step-31-integrate-typography">Lab 2</a>)</p><video src="videos/switcher.mp4" style="object-fit: none; object-position: top right;"></video><h3 id="step-44-actually-making-it-work"> <a href="#step-44-actually-making-it-work" class="anchor-heading" aria-labelledby="step-44-actually-making-it-work"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Step 4.4: Actually making it work</h3><p>We now have all the UI in place, but nothing happens when we change the theme. Here comes the fun part: making it work!</p><p>The first step is to attach an <code class="language-plaintext highlighter-rouge">input</code> event listener to our <code class="language-plaintext highlighter-rouge">&lt;select&gt;</code> element so we can run JS code when the user changes it. To do that, we first need to get a reference to the <code class="language-plaintext highlighter-rouge">&lt;select&gt;</code> element via <a href="https://developer.mozilla.org/en-US/docs/Web/API/Document/querySelector"><code class="language-plaintext highlighter-rouge">document.querySelector(selector)</code></a> and assign it to a variable (I called it <code class="language-plaintext highlighter-rouge">select</code>).</p><p>Then, we’d use the <code class="language-plaintext highlighter-rouge">addEventListener()</code> function to add a listener for the <code class="language-plaintext highlighter-rouge">input</code> event:</p><div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">select</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="dl">'</span><span class="s1">input</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">color scheme changed to</span><span class="dl">'</span><span class="p">,</span> <span class="nx">event</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">value</span><span class="p">);</span>
<span class="p">});</span>
</code></pre></div></div><p>Try it now: do you get the logged message in the console when you change the select element?</p><p>Okay, now we need to actually change the color scheme. As we’ve seen earlier, we can get a reference to the root element with <code class="language-plaintext highlighter-rouge">document.documentElement</code> and we can set arbitrary CSS properties on any element via <code class="language-plaintext highlighter-rouge">element.style.setProperty(property, value)</code>. Putting these together, we can set the <code class="language-plaintext highlighter-rouge">color-scheme</code> property on the root element via:</p><div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">document</span><span class="p">.</span><span class="nx">documentElement</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">setProperty</span><span class="p">(</span><span class="dl">'</span><span class="s1">color-scheme</span><span class="dl">'</span><span class="p">,</span> <span class="nx">event</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">value</span><span class="p">);</span>
</code></pre></div></div><p class="fyi"><a href="https://developer.mozilla.org/en-US/docs/Web/API/HTMLElement/style"><code class="language-plaintext highlighter-rouge">element.style</code></a> is an object that allows us to read and modify the inline style (i.e. the <code class="language-plaintext highlighter-rouge">style</code> attribute) of an element.</p><video src="videos/switcher.mp4" loop="" autoplay="" muted=""></video><h3 id="step-45-saving-the-users-preference"> <a href="#step-45-saving-the-users-preference" class="anchor-heading" aria-labelledby="step-45-saving-the-users-preference"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Step 4.5: Saving the user’s preference</h3><p>Notice that if you refresh the page, the color scheme goes back to automatic. How can we persist this across page loads?</p><p>We will use the <a href="https://developer.mozilla.org/en-US/docs/Web/API/Window/localStorage"><code class="language-plaintext highlighter-rouge">localStorage</code></a> object for this. It’s a simple object (its keys can only contain strings), but anything you put in it will persist across page loads or even browser sessions.</p><p>There are two components to persisting the user’s preference:</p><ol><li>Adding the user’s preference to <code class="language-plaintext highlighter-rouge">localStorage</code> when they change it. This is as simple as <code class="language-plaintext highlighter-rouge">localStorage.colorScheme = event.target.value</code> in our event listener.<li>Reading the user’s preference from <code class="language-plaintext highlighter-rouge">localStorage</code> when the page loads. For that, we need a conditional that would check if <code class="language-plaintext highlighter-rouge">localStorage</code> includes a <code class="language-plaintext highlighter-rouge">colorScheme</code> key (<code class="language-plaintext highlighter-rouge">"colorScheme" in localStorage</code>), and if it does, we’d set the color scheme to that value (just like any object, we can read that value via <code class="language-plaintext highlighter-rouge">localStorage.colorScheme</code>). Don’t forget to update the <code class="language-plaintext highlighter-rouge">&lt;select&gt;</code> element to match (by setting <code class="language-plaintext highlighter-rouge">select.value</code>), otherwise the user experience will be very confusing!</ol><p>That should work! Try it now: change the color scheme, refresh the page, and see if it sticks.</p><figure><p><img src="/labs/lab03/images/devtools-storage.png" alt="" /> <img src="/labs/lab03/images/devtools-localstorage-console.png" alt="" /></p><figcaption><p>Beyond trying out the functionality, there are two ways to verify that your data has been successfully saved in the browser’s local storage:</p><ol><li>In the Application tab of the dev tools, under the Storage section, you can see the <code class="language-plaintext highlighter-rouge">localStorage</code> object and its contents.<li>In the Console tab, you can type <code class="language-plaintext highlighter-rouge">localStorage</code> and see its contents.</ol></figcaption></figure><p class="tip">To avoid repeating the code that sets the color scheme twice (once for the event listener and once on page load if the preference is saved), you could define a <code class="language-plaintext highlighter-rouge">setColorScheme(colorScheme)</code> function that does that and call it in both places.</p><h2 id="step-5-better-contact-form-optional"> <a href="#step-5-better-contact-form-optional" class="anchor-heading" aria-labelledby="step-5-better-contact-form-optional"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Step 5: Better contact form <em>(Optional)</em></h2><p>You may have noticed that our contact form from Lab 1 did not have the best usability. While it does open an email client and prefills our email address in the To field, everything else is encoded with this weird format in the body of the email:</p><p><img src="/labs/lab03/images/contact-original.png" alt="" /></p><p>We <em>could</em> actually make it work better, but it will need a little JS.</p><p>First, we’d start by <em>removing</em> <code class="language-plaintext highlighter-rouge">enctype="text/plain"</code> and <code class="language-plaintext highlighter-rouge">method="POST"</code> (or changing it to <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Methods"><code class="language-plaintext highlighter-rouge">method="GET"</code></a>). An HTTP GET request <a href="https://developer.mozilla.org/en-US/docs/Learn/Common_questions/Web_mechanics/What_is_a_URL#parameters">encodes all submitted information in the URL</a>, so our form basically helps us build (and visits) a URL like <code class="language-plaintext highlighter-rouge">mailto:leaverou@mit.edu?subject=Hello&amp;body=Sup?</code>. Try pasting that URL in your browser, and notice how it opens <em>exactly</em> the same window, you’d get by submitting your form!</p><p><img src="/labs/lab03/images/contact-get.png" alt="" /></p><p>Let’s also remove the “From:” field. Since this form opens a window in our mail client, and the email is sent from us anyway, it’s redundant.</p><p>So far it looks like this is quite an improvement already. Why didn’t we do it this way in Lab 1 then? Because without JS, this has a fatal flaw. Try writing a longer subject and/or message that includes spaces and submit the form again:</p><p><img src="/labs/lab03/images/contact-get-problem.png" alt="" /></p><p>All our spaces have been replaced by <code class="language-plaintext highlighter-rouge">+</code> signs!</p><p>Why did this happen? When it comes to URLs, spaces are considered special characters and are not technically allowed. There are two ways to encode them: as <code class="language-plaintext highlighter-rouge">+</code> or as <code class="language-plaintext highlighter-rouge">%20</code>. The former is older and non-standard, but still widely used. However, not all clients recognize it (e.g. our mail client doesn’t!) whereas percent encoding (<code class="language-plaintext highlighter-rouge">%</code> plus a two-digit hexadecimal number, <code class="language-plaintext highlighter-rouge">20</code> for a space character) is <a href="https://www.rfc-editor.org/rfc/rfc3986#section-2.1">the standard way</a> and is always recognized.</p><p class="note">Don’t see any <code class="language-plaintext highlighter-rouge">+</code> signs? Some mail clients (e.g. Gmail) automatically decode the <code class="language-plaintext highlighter-rouge">+</code> signs to spaces. However, you cannot have a form that only works in some mail clients and not others, so we need to fix this.</p><p>There is no way to fix this with HTML alone, which is why we did not use this method in Lab 1. But now that we know JS, we have superpowers! We will <em>intercept</em> the form submission, and build the URL ourselves.</p><p>To recap, our goal is to build the same URL, but with proper escaping this time. We don’t need to handle the escaping ourselves, that’s what the <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/encodeURIComponent"><code class="language-plaintext highlighter-rouge">encodeURIComponent()</code></a> function is for.</p><p>First, get a reference to the <code class="language-plaintext highlighter-rouge">&lt;form&gt;</code> element, and add a listener to it for the <code class="language-plaintext highlighter-rouge">submit</code> event. Since this is code that runs on every page, and not every page has a form, to avoid errors either use a conditional to check that the reference is non-empty, or use <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Optional_chaining">optional chaining</a>, i.e. <code class="language-plaintext highlighter-rouge">form?.addEventListener()</code> instead of <code class="language-plaintext highlighter-rouge">form.addEventListener()</code>.</p><p>In the event handler, call <code class="language-plaintext highlighter-rouge">preventDefault</code> on the event object to prevent the default form submission from happening. Save and preview your work. Make sure that the form does not open your email client anymore.</p><p>Then, in the event handler, we create a new <code class="language-plaintext highlighter-rouge">FormData</code> object from the form (let’s call it <code class="language-plaintext highlighter-rouge">data</code>).</p><p>We can then iterate over submitted fields using a <code class="language-plaintext highlighter-rouge">for .. of</code> loop like this:</p><div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="p">[</span><span class="nx">name</span><span class="p">,</span> <span class="nx">value</span><span class="p">]</span> <span class="k">of</span> <span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// TODO build URL parameters here</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">value</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div><p>Save your work and submit the form. What do you see in the console? Now replace <code class="language-plaintext highlighter-rouge">value</code> with <code class="language-plaintext highlighter-rouge">encodeURIComponent(value)</code> and submit the form again. What changed?</p><p>We progressively build the URL by <a href="https://developer.mozilla.org/en-US/docs/Learn/JavaScript/First_steps/Strings#concatenation_using">concatenating</a> <code class="language-plaintext highlighter-rouge">form.action</code>, <code class="language-plaintext highlighter-rouge">"?"</code> and names and encoded values (separated by <code class="language-plaintext highlighter-rouge">=</code>) for each field.</p><p>Once we have our final URL, we can open it via:</p><div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">location</span><span class="p">.</span><span class="nx">href</span> <span class="o">=</span> <span class="nx">url</span><span class="p">;</span>
</code></pre></div></div><p class="fyi">For any other URL, this would navigate to another page, but because this is a <code class="language-plaintext highlighter-rouge">mailto:</code> URL, it will open our email client with the prefilled fields.</p><p><img src="/labs/lab03/images/contact-works.png" alt="" /></p><h2 id="js-resources"> <a href="#js-resources" class="anchor-heading" aria-labelledby="js-resources"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> JS resources</h2><ul><li><a href="https://developer.mozilla.org/en-US/docs/Learn/Getting_started_with_the_web/JavaScript_basics">MDN: JavaScript Basics</a><li><a href="https://developer.mozilla.org/en-US/docs/Learn/JavaScript/First_steps">MDN: JavaScript First Steps</a><li><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript">MDN Tutorials on JS</a><li><a href="https://shamansir.github.io/JavaScript-Garden/">JS Garden</a> for JS quirks and gotchas<li><a href="https://observablehq.com/@dakoop/learn-js-data">Learn JS Data</a>, a series of Observable notebooks about the basics of manipulating data using JavaScript in the browser.</ul><h3 id="videos"> <a href="#videos" class="anchor-heading" aria-labelledby="videos"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Videos</h3><ul><li><a href="https://www.youtube.com/watch?v=Ukg_U3CnJWI">JavaScript in 12 Minutes</a><li><a href="https://www.youtube.com/watch?v=W6NZfCO5SIk">JS 1-Hour tutorial</a><li><a href="https://www.w3resource.com/course/javascript-course.html#/slide-instructions">A series of interactive JavaScript Tutorials</a><li><a href="https://www.udemy.com/course/javascript-basics-for-beginners/">Udemy course</a></ul><h3 id="books"> <a href="#books" class="anchor-heading" aria-labelledby="books"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Books</h3><ul><li><a href="http://eloquentjavascript.net/">Eloquent Javascript</a> by Marijn Haverbeke – free online book for programming beginners<li><a href="http://www.amazon.com/dp/0596517742">JavaScript: The Good Parts</a> by Douglas Crockford (See also his YUI videos)<li><a href="http://addyosmani.com/resources/essentialjsdesignpatterns/book/">Learning JavaScript Design Patterns</a> by Addy Osmani</ul></div></div><div class="search-overlay"></div></div>
